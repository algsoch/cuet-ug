<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DU Admission Analyzer - Interactive Dashboard</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #1e40af;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-color: #1f2937;
            --light-color: #f8fafc;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .dashboard-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin: 20px;
            padding: 30px;
            min-height: 90vh;
        }

        .header-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .stats-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        .stats-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        /* Vacancy Analysis Styles */
        .analysis-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .metric-card {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid var(--primary-color);
        }

        .insights-panel, .recommendations-panel {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            height: 100%;
        }

        .insight-item, .recommendation-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #3b82f6;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .recommendation-item {
            border-left-color: #10b981;
        }

        .vacancy-chart-canvas {
            height: 250px !important;
        }

        #vacancyAnalysisSection {
            display: none;
        }

        .search-indicator {
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .search-indicator i {
            font-size: 1.1em;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .play-button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .play-button:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
        }

        .play-button:disabled {
            background: #6b7280;
            cursor: not-allowed;
            transform: none;
        }

        .search-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .search-input {
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 15px 20px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            position: relative;
        }

        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 10px 10px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-suggestion {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
        }

        .search-suggestion:hover {
            background-color: #f8fafc;
        }

        .search-suggestion:last-child {
            border-bottom: none;
        }

        .filter-buttons {
            gap: 10px;
            margin-top: 15px;
        }

        .filter-btn {
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            background: transparent;
            border-radius: 25px;
            padding: 8px 20px;
            transition: all 0.3s ease;
        }

        .filter-btn.active, .filter-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 50px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #e5e7eb;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .data-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
        }

        .table {
            border-radius: 10px;
            overflow: hidden;
        }

        .table thead th {
            background: var(--primary-color);
            color: white;
            border: none;
            font-weight: 600;
            padding: 15px;
        }

        .table tbody td {
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        .table tbody tr:hover {
            background: #f8fafc;
        }

        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #dc2626;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                margin: 10px;
                padding: 20px;
            }
            
            .header-section {
                padding: 20px;
            }
            
            .stats-card {
                text-align: center;
            }
            
            .chart-header {
                flex-direction: column;
                gap: 15px;
            }
        }
        
        /* Enhanced responsiveness for charts */
        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 300px !important;
        }
        
        .chart-container {
            padding: 20px;
            margin-bottom: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 380px;
        }
        
        /* Table improvements */
        .table-responsive {
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        
        .college-name {
            min-width: 200px;
            word-wrap: break-word;
            white-space: normal;
        }
        
        .program-name {
            min-width: 250px;
            word-wrap: break-word;
            white-space: normal;
        }
        
        /* Allow table to expand horizontally */
        .table {
            table-layout: auto;
            width: 100%;
        }
        
        .table th, .table td {
            white-space: normal;
            word-wrap: break-word;
            vertical-align: middle;
        }
        
        /* Better table spacing for long text */
        .table td {
            padding: 12px 8px;
            line-height: 1.4;
        }
        
        .table th {
            position: sticky;
            top: 0;
            background-color: #343a40;
            z-index: 10;
        }
        
        /* Sortable header styles */
        .sortable-header {
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s ease;
        }
        
        .sortable-header:hover {
            background-color: #495057 !important;
        }
        
        .sortable-header.sorted-asc i.fas.fa-sort::before {
            content: "\f0de"; /* fa-sort-up */
        }
        
        .sortable-header.sorted-desc i.fas.fa-sort::before {
            content: "\f0dd"; /* fa-sort-down */
        }
        
        .sortable-header i {
            opacity: 0.6;
            transition: opacity 0.2s ease;
        }
        
        .sortable-header:hover i {
            opacity: 1;
        }
        
        /* Filter improvements */
        .search-input {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: border-color 0.3s ease;
        }
        
        .search-input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.25);
        }
        
        .filter-btn {
            margin: 2px;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active {
            background-color: #007bff;
            color: white;
            transform: scale(1.05);
        }
        
        /* Mobile improvements */
        @media (max-width: 768px) {
            .college-name {
                max-width: 120px;
            }
            
            .program-name {
                max-width: 100px;
            }
            
            .table td, .table th {
                padding: 0.5rem 0.3rem;
                font-size: 0.85rem;
            }
            
            .badge {
                font-size: 0.7rem;
            }
            
            .search-section {
                margin-bottom: 1rem;
            }
            
            .filter-buttons {
                justify-content: center;
            }
        }

        /* Totals Row Styling */
        .table-totals-row {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%) !important;
            border-top: 3px solid #ffc107 !important;
            box-shadow: 0 2px 8px rgba(255, 193, 7, 0.2);
        }

        .table-totals-row td {
            padding: 12px 8px !important;
            vertical-align: middle;
        }

        .table-totals-row .badge {
            font-size: 0.9rem;
            padding: 6px 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Lightweight Table Hover Effects - Performance Optimized */
        .table tbody tr {
            transition: background-color 0.15s ease, box-shadow 0.15s ease;
            cursor: pointer;
        }

        .table tbody tr:not(.table-totals-row):hover {
            background-color: #f8f9fa !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Simple row number highlight */
        .table tbody tr:not(.table-totals-row) td:first-child {
            font-weight: bold;
            color: var(--secondary-color);
            text-align: center;
            transition: background-color 0.15s ease, color 0.15s ease;
        }

        .table tbody tr:not(.table-totals-row):hover td:first-child {
            background-color: var(--primary-color);
            color: white;
            border-radius: 4px;
        }

        /* Simple badge hover */
        .table .badge {
            transition: transform 0.1s ease;
            cursor: pointer;
        }

        .table .badge:hover {
            transform: scale(1.05);
        }

        /* College and Program name simple hover */
        .college-name, .program-name {
            transition: background-color 0.15s ease, color 0.15s ease;
            padding: 4px 8px;
            border-radius: 4px;
        }

        .college-name:hover, .program-name:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .college-name:hover strong {
            color: white;
        }

        /* Simple header hover */
        .table thead th {
            transition: background-color 0.15s ease, color 0.15s ease;
            cursor: pointer;
        }

        .table thead th:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Totals row simple hover */
        .table-totals-row {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%) !important;
            border-top: 3px solid #ffc107 !important;
            transition: background-color 0.15s ease;
        }

        .table-totals-row:hover {
            background: #ffc107 !important;
        }

        .table-totals-row td {
            padding: 12px 8px !important;
            vertical-align: middle;
        }

        .table-totals-row .badge {
            font-size: 0.9rem;
            padding: 6px 10px;
        }

        /* Selected row styling - simplified */
        .table tbody tr.selected {
            background-color: #e3f2fd !important;
            border-left: 4px solid var(--primary-color);
        }

        .table tbody tr.selected td:first-child {
            background-color: var(--primary-color);
            color: white;
            border-radius: 4px;
        }

        /* Remove all complex animations and transforms */
        .table * {
            will-change: auto;
        }

        /* Simple responsive adjustments */
        @media (max-width: 768px) {
            .table tbody tr:hover {
                box-shadow: none;
            }
        }
        /* Simple tooltips using browser defaults */
        .college-name[title], .program-name[title] {
            cursor: help;
        }

        /* Search results highlighting */
        .search-results-highlighted {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%) !important;
            border: 2px solid #2196f3 !important;
            border-radius: 8px !important;
            animation: searchHighlight 2s ease-in-out;
        }
        
        @keyframes searchHighlight {
            0% { box-shadow: 0 0 0 rgba(33, 150, 243, 0.4); }
            50% { box-shadow: 0 0 20px rgba(33, 150, 243, 0.6); }
            100% { box-shadow: 0 0 0 rgba(33, 150, 243, 0.4); }
        }
        
        .search-results-indicator {
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
            border-left: 4px solid #4caf50;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Toggle switch styling */
        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .pagination-info {
            background: #f8f9fa;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        /* Table transition effects */
        .table-transition {
            transition: all 0.3s ease;
        }
        
        .highlighted-row {
            background-color: #fff3cd !important;
            animation: rowHighlight 1s ease-in-out;
        }
        
        @keyframes rowHighlight {
            0% { background-color: #fff3cd; }
            50% { background-color: #ffeaa7; }
            100% { background-color: #fff3cd; }
        }
        /* Minimal responsive adjustments */
        @media (max-width: 768px) {
            .table tbody tr:hover {
                box-shadow: none;
            }
            
            .college-name:hover, .program-name:hover {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header Section -->
        <div class="header-section">
            <h1 class="mb-3"><i class="fas fa-graduation-cap me-3"></i>DU Admission Analyzer</h1>
            <p class="mb-0">Interactive Dashboard for Delhi University Admission Analysis</p>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="loading-spinner">
            <div class="spinner mx-auto mb-3"></div>
            <p>Loading dashboard data...</p>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="error-message" style="display: none;">
            <i class="fas fa-exclamation-triangle me-2"></i>
            <span id="errorText">Unable to load data. Please refresh the page.</span>
        </div>

        <!-- Main Dashboard Content -->
        <div id="dashboardContent" style="display: none;">
            <!-- Statistics Cards -->
            <div class="row mb-4">
                <div class="col-md-3 col-sm-6">
                    <div class="stats-card text-center">
                        <div class="stats-icon text-primary">
                            <i class="fas fa-university"></i>
                        </div>
                        <div class="stats-number text-primary" id="totalColleges">83</div>
                        <div class="text-muted">Total Colleges</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="stats-card text-center">
                        <div class="stats-icon text-success">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="stats-number text-success" id="totalPrograms">176</div>
                        <div class="text-muted">Total Programs 
                            <small class="text-info">(All Records)</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="stats-card text-center">
                        <div class="stats-icon text-warning">
                            <i class="fas fa-chair"></i>
                        </div>
                        <div class="stats-number text-warning" id="totalSeats">12,840</div>
                        <div class="text-muted">Total Seats</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6">
                    <div class="stats-card text-center">
                        <div class="stats-icon text-info">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stats-number text-info" id="avgSeats">73</div>
                        <div class="text-muted">Avg Seats/Program</div>
                    </div>
                </div>
            </div>

            <!-- Advanced Insights Section -->
            <div id="insightsContainer" class="mb-4">
                <!-- Insights will be populated dynamically -->
            </div>

            <!-- Search and Filter Section -->
            <div class="search-section mb-4">
                <h4 class="mb-3"><i class="fas fa-search me-2"></i>Advanced Search & Filter</h4>
                
                <!-- Search Row -->
                <div class="row mb-3">
                    <div class="col-md-8">
                        <div class="input-group position-relative">
                            <input type="text" id="searchInput" class="form-control search-input" 
                                   placeholder="Search colleges, programs, or any keyword..."
                                   autocomplete="off">
                            <div id="searchSuggestions" class="search-suggestions"></div>
                            <button class="btn btn-primary" type="button" id="searchBtn" onclick="performSearch()">
                                <i class="fas fa-search"></i> Search
                            </button>
                            <button class="btn btn-outline-secondary" type="button" onclick="toggleAdvancedSearch()">
                                <i class="fas fa-cog"></i> Advanced
                            </button>
                            <button class="btn btn-outline-secondary" type="button" id="clearBtn">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <select id="categoryFilter" class="form-select search-input">
                            <option value="">All Categories</option>
                            <option value="UR">UR (Unreserved)</option>
                            <option value="OBC">OBC</option>
                            <option value="SC">SC</option>
                            <option value="ST">ST</option>
                            <option value="EWS">EWS</option>
                            <option value="SIKH">SIKH</option>
                            <option value="PwBD">PwBD</option>
                        </select>
                    </div>
                </div>
                
                <!-- Advanced Filters Row -->
                <div class="row mb-3">
                    <div class="col-md-4">
                        <select id="collegeFilter" class="form-select search-input">
                            <option value="">All Colleges</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select id="programFilter" class="form-select search-input">
                            <option value="">All Programs</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select id="sortBy" class="form-select search-input">
                            <option value="">Sort By</option>
                            <option value="college">College Name (A-Z)</option>
                            <option value="program">Program Name (A-Z)</option>
                            <option value="total_seats">Total Seats (High to Low)</option>
                            <option value="ur_seats">UR Seats (High to Low)</option>
                            <option value="obc_seats">OBC Seats (High to Low)</option>
                            <option value="sc_seats">SC Seats (High to Low)</option>
                            <option value="st_seats">ST Seats (High to Low)</option>
                            <option value="ews_seats">EWS Seats (High to Low)</option>
                            <option value="sikh_seats">SIKH Seats (High to Low)</option>
                            <option value="pwbd_seats">PwBD Seats (High to Low)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Quick Filter Buttons - DYNAMIC based on actual data -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="filter-buttons d-flex flex-wrap gap-2" id="dynamicFilterButtons">
                        <!-- Will be populated dynamically from actual CSV data -->
                    </div>
                    <button class="btn btn-outline-danger ms-3" onclick="clearAllFilters()">
                        <i class="fas fa-eraser"></i> Clear All Filters
                    </button>
                </div>
                
                <!-- Results Summary -->
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <small class="text-muted" id="resultCount">Loading results...</small>
                    <small class="text-muted">
                        <i class="fas fa-lightbulb"></i> 
                        Tip: Use abbreviations like "CS" for Computer Science or "DU" for Delhi University
                    </small>
                </div>
            </div>

            <!-- Advanced Search Results Section (Initially Hidden) -->
            <div id="searchResultsSection" class="mb-4" style="display: none;">
                <div class="card border-success">
                    <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-table"></i> Search Results</h5>
                        <div id="searchResultsCount" class="badge bg-light text-dark">0 results</div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-dark">
                                    <tr>
                                        <th>S.No.</th>
                                        <th>College Name</th>
                                        <th>Program Name</th>
                                        <th>UR</th>
                                        <th>OBC</th>
                                        <th>SC</th>
                                        <th>ST</th>
                                        <th>EWS</th>
                                        <th>SIKH</th>
                                        <th>PwBD</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="searchResultsTable">
                                    <!-- Search results will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        <!-- Search Results Pagination -->
                        <div id="searchPaginationContainer" class="p-3"></div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="row g-3 mb-4">
                <!-- College Distribution Chart -->
                <div class="col-lg-6 col-md-12">
                    <div class="chart-container h-100">
                        <div class="chart-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Top Colleges by Available Seats</h5>
                            <button class="play-button" id="collegeChartBtn" onclick="renderCollegeChart()">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                        <div class="chart-wrapper" style="position: relative; height: 300px;">
                            <canvas id="collegeChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Program Distribution Chart -->
                <div class="col-lg-6 col-md-12">
                    <div class="chart-container h-100">
                        <div class="chart-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Top Programs by Available Seats</h5>
                            <button class="play-button" id="programChartBtn" onclick="renderProgramChart()">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                        <div class="chart-wrapper" style="position: relative; height: 300px;">
                            <canvas id="programChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-3 mb-4">
                <!-- Category Distribution Chart -->
                <div class="col-lg-6 col-md-12">
                    <div class="chart-container h-100">
                        <div class="chart-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-chart-doughnut me-2"></i>Category-wise Distribution</h5>
                            <button class="play-button" id="categoryChartBtn" onclick="renderCategoryChart()">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                        <div class="chart-wrapper" style="position: relative; height: 300px;">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Trend Analysis Chart -->
                <div class="col-lg-6 col-md-12">
                    <div class="chart-container h-100">
                        <div class="chart-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>Top Colleges Seats Analysis</h5>
                            <button class="play-button" id="trendChartBtn" onclick="renderTrendChart()" title="Generate trend analysis">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                        <div class="chart-wrapper" style="position: relative; height: 300px;">
                            <canvas id="trendChart"></canvas>
                        </div>
                        <small class="text-muted mt-2 d-block">
                            <i class="fas fa-info-circle me-1"></i>
                            Shows seat distribution trends across top 10 colleges by capacity
                        </small>
                    </div>
                </div>
            </div>

            <!-- Advanced Vacancy Analysis Section -->
            <div class="row mb-4" id="vacancyAnalysisSection" style="display: none;">
                <div class="col-12">
                    <div class="analysis-container">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h4><i class="fas fa-brain me-2"></i>Advanced Vacancy Analysis</h4>
                            <button class="btn btn-primary" onclick="loadVacancyAnalysis()">
                                <i class="fas fa-sync-alt me-1"></i>Refresh Analysis
                            </button>
                        </div>

                        <!-- Core Statistics Row -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="metric-card text-center">
                                    <h5>Total Vacancies</h5>
                                    <h2 id="totalVacancies" class="text-primary">-</h2>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card text-center">
                                    <h5>Top Category</h5>
                                    <h3 id="topCategory" class="text-success">-</h3>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card text-center">
                                    <h5>Concentration Index</h5>
                                    <h3 id="concentrationIndex" class="text-warning">-</h3>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="metric-card text-center">
                                    <h5>Zero Vacancy Programs</h5>
                                    <h3 id="zeroVacancyCount" class="text-danger">-</h3>
                                </div>
                            </div>
                        </div>

                        <!-- Visualizations Row -->
                        <div class="row mb-4">
                            <!-- Category Distribution Pie Chart -->
                            <div class="col-lg-4">
                                <div class="chart-container">
                                    <h5><i class="fas fa-pie-chart me-2"></i>Category Distribution</h5>
                                    <canvas id="vacancyCategoryChart" class="vacancy-chart-canvas"></canvas>
                                </div>
                            </div>

                            <!-- Top Colleges Treemap -->
                            <div class="col-lg-4">
                                <div class="chart-container">
                                    <h5><i class="fas fa-sitemap me-2"></i>Top Colleges by Seats</h5>
                                    <canvas id="collegeTreemapChart" class="vacancy-chart-canvas"></canvas>
                                </div>
                            </div>

                            <!-- Program Stacked Bar -->
                            <div class="col-lg-4">
                                <div class="chart-container">
                                    <h5><i class="fas fa-chart-bar me-2"></i>Top Programs by Category</h5>
                                    <canvas id="programStackedChart" class="vacancy-chart-canvas"></canvas>
                                </div>
                            </div>
                        </div>

                        <!-- Insights and Recommendations Row -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="insights-panel">
                                    <h5><i class="fas fa-lightbulb me-2 text-warning"></i>Key Insights</h5>
                                    <div id="insightsList" class="insights-list">
                                        <!-- Insights will be populated here -->
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="recommendations-panel">
                                    <h5><i class="fas fa-star me-2 text-success"></i>Smart Recommendations</h5>
                                    <div id="recommendationsList" class="recommendations-list">
                                        <!-- Recommendations will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Metrics Table -->
                        <div class="row">
                            <div class="col-12">
                                <h5><i class="fas fa-table me-2"></i>Advanced Metrics</h5>
                                <div class="table-responsive">
                                    <table class="table table-bordered">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>Metric</th>
                                                <th>Value</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody id="metricsTableBody">
                                            <!-- Metrics will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Analysis Tabs -->
            <div class="row mb-4" id="advancedAnalysisSection" style="display: none;">
                <div class="col-12">
                    <div class="analysis-container">
                        <h4><i class="fas fa-analytics me-2"></i>Comprehensive Analysis Dashboard</h4>
                        
                        <!-- Tab Navigation -->
                        <ul class="nav nav-tabs mb-3" id="analysisTabNav" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="college-tab" data-bs-toggle="tab" data-bs-target="#college-analysis" 
                                        type="button" role="tab" onclick="loadCollegeAnalysis()">
                                    <i class="fas fa-university me-2"></i>By College
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="program-tab" data-bs-toggle="tab" data-bs-target="#program-analysis" 
                                        type="button" role="tab" onclick="loadProgramAnalysis()">
                                    <i class="fas fa-graduation-cap me-2"></i>By Program
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="category-tab" data-bs-toggle="tab" data-bs-target="#category-analysis" 
                                        type="button" role="tab" onclick="loadCategoryAnalysis()">
                                    <i class="fas fa-tags me-2"></i>By Category
                                </button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content" id="analysisTabContent">
                            <!-- College Analysis Tab -->
                            <div class="tab-pane fade show active" id="college-analysis" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="metric-card text-center">
                                            <h5>Total Colleges</h5>
                                            <h2 id="collegeAnalysisTotal" class="text-primary">-</h2>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card text-center">
                                            <h5>Avg Seats per College</h5>
                                            <h2 id="collegeAnalysisAvg" class="text-success">-</h2>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card text-center">
                                            <h5>Top College Seats</h5>
                                            <h2 id="collegeAnalysisTop" class="text-warning">-</h2>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card text-center">
                                            <input type="text" id="collegeSearchInput" class="form-control" placeholder="Search colleges..." onkeyup="filterCollegeAnalysis()">
                                        </div>
                                    </div>
                                </div>
                                <div class="table-responsive mt-3">
                                    <table class="table table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th onclick="sortAnalysisTable('college', 'college')" class="sortable-header" title="Click to sort by College Name">
                                                    College <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('college', 'totalSeats')" class="sortable-header" title="Click to sort by Total Seats">
                                                    Total Seats <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('college', 'ur')" class="sortable-header" title="Click to sort by UR seats">
                                                    UR <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('college', 'obc')" class="sortable-header" title="Click to sort by OBC seats">
                                                    OBC <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('college', 'sc')" class="sortable-header" title="Click to sort by SC seats">
                                                    SC <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('college', 'st')" class="sortable-header" title="Click to sort by ST seats">
                                                    ST <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('college', 'ews')" class="sortable-header" title="Click to sort by EWS seats">
                                                    EWS <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('college', 'sikh')" class="sortable-header" title="Click to sort by SIKH seats">
                                                    SIKH <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('college', 'pwbd')" class="sortable-header" title="Click to sort by PwBD seats">
                                                    PwBD <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('college', 'programs')" class="sortable-header" title="Click to sort by Program Count">
                                                    Programs <i class="fas fa-sort ms-1"></i>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="collegeAnalysisTable">
                                            <!-- Data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Program Analysis Tab -->
                            <div class="tab-pane fade" id="program-analysis" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="metric-card text-center">
                                            <h5>Total Programs</h5>
                                            <h2 id="programAnalysisTotal" class="text-primary">-</h2>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card text-center">
                                            <h5>Avg Seats per Program</h5>
                                            <h2 id="programAnalysisAvg" class="text-success">-</h2>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card text-center">
                                            <h5>Top Program Seats</h5>
                                            <h2 id="programAnalysisTop" class="text-warning">-</h2>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="metric-card text-center">
                                            <input type="text" id="programSearchInput" class="form-control" placeholder="Search programs..." onkeyup="filterProgramAnalysis()">
                                        </div>
                                    </div>
                                </div>
                                <div class="table-responsive mt-3">
                                    <table class="table table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th onclick="sortAnalysisTable('program', 'program')" class="sortable-header" title="Click to sort by Program Name">
                                                    Program <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('program', 'totalSeats')" class="sortable-header" title="Click to sort by Total Seats">
                                                    Total Seats <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('program', 'ur')" class="sortable-header" title="Click to sort by UR seats">
                                                    UR <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('program', 'obc')" class="sortable-header" title="Click to sort by OBC seats">
                                                    OBC <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('program', 'sc')" class="sortable-header" title="Click to sort by SC seats">
                                                    SC <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('program', 'st')" class="sortable-header" title="Click to sort by ST seats">
                                                    ST <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('program', 'ews')" class="sortable-header" title="Click to sort by EWS seats">
                                                    EWS <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('program', 'sikh')" class="sortable-header" title="Click to sort by SIKH seats">
                                                    SIKH <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('program', 'pwbd')" class="sortable-header" title="Click to sort by PwBD seats">
                                                    PwBD <i class="fas fa-sort ms-1"></i>
                                                </th>
                                                <th onclick="sortAnalysisTable('program', 'colleges')" class="sortable-header" title="Click to sort by College Count">
                                                    Colleges <i class="fas fa-sort ms-1"></i>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="programAnalysisTable">
                                            <!-- Data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Category Analysis Tab -->
                            <div class="tab-pane fade" id="category-analysis" role="tabpanel">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="metric-card text-center">
                                            <h5>Total Categories</h5>
                                            <h2 id="categoryAnalysisTotal" class="text-primary">7</h2>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="metric-card text-center">
                                            <h5>Highest Category</h5>
                                            <h2 id="categoryAnalysisHighest" class="text-success">-</h2>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="metric-card text-center">
                                            <h5>Lowest Category</h5>
                                            <h2 id="categoryAnalysisLowest" class="text-warning">-</h2>
                                        </div>
                                    </div>
                                </div>
                                <div class="table-responsive mt-3">
                                    <table class="table table-hover">
                                        <thead class="table-dark">
                                            <tr>
                                                <th>Category</th>
                                                <th>Total Seats</th>
                                                <th>Percentage</th>
                                                <th>Colleges</th>
                                                <th>Programs</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody id="categoryAnalysisTable">
                                            <!-- Data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Data Table Section -->
            <div class="data-table" id="mainDataTable">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5><i class="fas fa-table me-2"></i>Admission Data</h5>
                    <div class="d-flex align-items-center gap-3">
                        <!-- Pagination Toggle Switch -->
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="paginationToggle" checked onchange="togglePagination()">
                            <label class="form-check-label" for="paginationToggle">
                                <span id="toggleLabel">Show 70 rows</span>
                            </label>
                        </div>
                        <!-- Show All Data Button -->
                        <button class="btn btn-info btn-sm" onclick="showAllData()" title="Show all 1528 entries">
                            <i class="fas fa-list me-1"></i>Show All
                        </button>
                        <span class="badge bg-primary" id="resultCount">0 results</span>
                        <button class="btn btn-success btn-sm" onclick="exportToExcel()">
                            <i class="fas fa-download me-1"></i>Export Excel
                        </button>
                    </div>
                </div>
                
                <!-- Search Input -->
                <div class="row mb-3">
                    <div class="col-md-8">
                        <div class="input-group">
                            <span class="input-group-text">
                                <i class="fas fa-search"></i>
                            </span>
                            <input type="text" class="form-control search-input" id="mainTableSearch" 
                                   placeholder="Search by college name, program name, or any data..." 
                                   onkeyup="filterMainTable()" autocomplete="off">
                            <button class="btn btn-outline-secondary" onclick="clearMainTableSearch()" type="button">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <small class="text-muted">
                            <i class="fas fa-info-circle me-1"></i>
                            Search across all columns including college and program names
                        </small>
                    </div>
                </div>
                
                <!-- Search Results Indicator -->
                <div id="searchResultsIndicator" class="alert alert-info mb-3" style="display: none;">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-search me-2"></i>
                        <span id="searchResultsText">Search results</span>
                        <button class="btn btn-sm btn-outline-primary ms-auto" onclick="clearSearchAndScroll()">
                            <i class="fas fa-times"></i> Clear & Show All
                        </button>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th onclick="sortMainTable('sno')" class="sortable-header" title="Click to sort by Serial Number">
                                    S.No <i class="fas fa-sort ms-1"></i>
                                </th>
                                <th onclick="sortMainTable('college')" class="sortable-header" title="Click to sort by College Name">
                                    College Name <i class="fas fa-sort ms-1"></i>
                                </th>
                                <th onclick="sortMainTable('program')" class="sortable-header" title="Click to sort by Program Name">
                                    Program Name <i class="fas fa-sort ms-1"></i>
                                </th>
                                <th onclick="sortMainTable('ur')" class="sortable-header" title="Click to sort by UR seats">
                                    UR <i class="fas fa-sort ms-1"></i>
                                </th>
                                <th onclick="sortMainTable('obc')" class="sortable-header" title="Click to sort by OBC seats">
                                    OBC <i class="fas fa-sort ms-1"></i>
                                </th>
                                <th onclick="sortMainTable('sc')" class="sortable-header" title="Click to sort by SC seats">
                                    SC <i class="fas fa-sort ms-1"></i>
                                </th>
                                <th onclick="sortMainTable('st')" class="sortable-header" title="Click to sort by ST seats">
                                    ST <i class="fas fa-sort ms-1"></i>
                                </th>
                                <th onclick="sortMainTable('ews')" class="sortable-header" title="Click to sort by EWS seats">
                                    EWS <i class="fas fa-sort ms-1"></i>
                                </th>
                                <th onclick="sortMainTable('sikh')" class="sortable-header" title="Click to sort by SIKH seats">
                                    SIKH <i class="fas fa-sort ms-1"></i>
                                </th>
                                <th onclick="sortMainTable('pwbd')" class="sortable-header" title="Click to sort by PwBD seats">
                                    PwBD <i class="fas fa-sort ms-1"></i>
                                </th>
                                <th onclick="sortMainTable('total')" class="sortable-header" title="Click to sort by Total seats">
                                    Total <i class="fas fa-sort ms-1"></i>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="dataTableBody">
                            <!-- Data will be populated here -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Pagination Controls -->
                <div id="paginationContainer" class="d-flex justify-content-center mt-3">
                    <!-- Pagination will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Application JavaScript -->
    <script>
        // Global variables
        let admissionData = [];
        let chartData = {};
        let advancedAnalytics = {};
        let charts = {};
        let currentPage = 1;
        let itemsPerPage = 70;
        let isPaginationEnabled = true;
        let filteredData = [];
        let isSearchActive = false;
        
        // Initialize window.currentPage to sync with global currentPage
        window.currentPage = currentPage;
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log(' Initializing DU Admission Analyzer Dashboard');
            loadDashboardData();
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            const searchInput = document.getElementById('searchInput');
            const categoryFilter = document.getElementById('categoryFilter');
            const collegeFilter = document.getElementById('collegeFilter');
            const programFilter = document.getElementById('programFilter');
            const sortBy = document.getElementById('sortBy');
            const searchBtn = document.getElementById('searchBtn');
            const clearBtn = document.getElementById('clearBtn');
            
            // Search functionality
            searchInput.addEventListener('input', debounce(handleSearchInput, 300));
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    handleSearch();
                }
            });
            searchBtn.addEventListener('click', handleSearch);
            
            // Filter functionality
            categoryFilter.addEventListener('change', filterData);
            collegeFilter.addEventListener('change', filterData);
            programFilter.addEventListener('change', filterData);
            sortBy.addEventListener('change', filterData);
            
            // Clear functionality
            clearBtn.addEventListener('click', clearFilters);
            
            // Search suggestions
            searchInput.addEventListener('focus', showSearchSuggestions);
            searchInput.addEventListener('blur', hideSearchSuggestions);
        }
        
        // Handle search input with suggestions
        function handleSearchInput() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (query.length > 1) {
                updateSearchSuggestions(query);
            } else {
                hideSearchSuggestions();
            }
            filterData();
        }
        
        // Update search suggestions
        function updateSearchSuggestions(query) {
            const suggestionContainer = document.getElementById('searchSuggestions');
            const suggestions = new Set();
            
            // Get suggestions from colleges and programs
            admissionData.forEach(row => {
                const college = row['NAME OF THE COLLEGE'] || '';
                const program = row['NAME OF THE PROGRAM'] || '';
                
                if (college.toLowerCase().includes(query)) {
                    suggestions.add(college);
                }
                if (program.toLowerCase().includes(query)) {
                    suggestions.add(program);
                }
            });
            
            // Limit to 5 suggestions
            const limitedSuggestions = Array.from(suggestions).slice(0, 5);
            
            if (limitedSuggestions.length > 0) {
                suggestionContainer.innerHTML = limitedSuggestions
                    .map(suggestion => `<div class="search-suggestion" onclick="selectSuggestion('${suggestion.replace(/'/g, "\\'")}')">${suggestion}</div>`)
                    .join('');
                suggestionContainer.style.display = 'block';
            } else {
                hideSearchSuggestions();
            }
        }
        
        // Select a suggestion
        function selectSuggestion(suggestion) {
            document.getElementById('searchInput').value = suggestion;
            hideSearchSuggestions();
            filterData();
        }
        
        // Show search suggestions
        function showSearchSuggestions() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (query.length > 1) {
                updateSearchSuggestions(query);
            }
        }
        
        // Hide search suggestions
        function hideSearchSuggestions() {
            setTimeout(() => {
                document.getElementById('searchSuggestions').style.display = 'none';
            }, 200);
        }
        
        // Clear all filters
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('collegeFilter').value = '';
            document.getElementById('programFilter').value = '';
            document.getElementById('sortBy').value = '';
            filterData();
        }
        
        // Clear all filters including quick filter buttons
        function clearAllFilters() {
            // Clear search and dropdowns
            clearFilters();
            
            // Reset quick filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.filter-btn[onclick*="all"]').classList.add('active');
            
            // Reset to show all data
            populateDataTable(admissionData, currentPage, itemsPerPage);
            updateResultCount(admissionData.length);
        }
        
        // Populate filter dropdowns and create dynamic filter buttons
        function populateFilters(data) {
            console.log('Populating filters with data:', data);
            
            // Extract unique colleges and programs from raw CSV data
            const colleges = [...new Set(data.map(item => item['NAME OF THE COLLEGE']))]
                .filter(c => c && c.trim() && c.length > 3)
                .sort();
            
            const programs = [...new Set(data.map(item => item['NAME OF THE PROGRAM']))]
                .filter(p => p && p.trim() && p.length > 3)
                .sort();
            
            const collegeFilter = document.getElementById('collegeFilter');
            const programFilter = document.getElementById('programFilter');
            
            // Clear existing options
            collegeFilter.innerHTML = '<option value="">All Colleges</option>';
            programFilter.innerHTML = '<option value="">All Programs</option>';
            
            // Populate college options
            colleges.forEach(college => {
                const option = document.createElement('option');
                option.value = college;
                option.textContent = college.length > 40 ? college.substring(0, 40) + '...' : college;
                option.title = college; // Full name on hover
                collegeFilter.appendChild(option);
            });
            
            // Populate program options with better grouping
            const programGroups = {};
            programs.forEach(program => {
                // Group by degree type
                let group = 'Other';
                if (program.includes('B.Com')) group = 'B.Com';
                else if (program.includes('B.Sc')) group = 'B.Sc';
                else if (program.includes('B.A')) group = 'B.A';
                else if (program.includes('Bachelor Of Elementary Education')) group = 'B.El.Ed';
                else if (program.includes('Bachelor Of Management Studies')) group = 'BMS';
                
                if (!programGroups[group]) programGroups[group] = [];
                programGroups[group].push(program);
            });
            
            // Add grouped options
            Object.keys(programGroups).sort().forEach(groupName => {
                if (programGroups[groupName].length > 1) {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = `${groupName} Programs`;
                    
                    programGroups[groupName].sort().forEach(program => {
                        const option = document.createElement('option');
                        option.value = program;
                        option.textContent = program.length > 35 ? program.substring(0, 35) + '...' : program;
                        option.title = program; // Full name on hover
                        optgroup.appendChild(option);
                    });
                    
                    programFilter.appendChild(optgroup);
                } else {
                    // Single programs without grouping
                    programGroups[groupName].forEach(program => {
                        const option = document.createElement('option');
                        option.value = program;
                        option.textContent = program.length > 35 ? program.substring(0, 35) + '...' : program;
                        option.title = program;
                        programFilter.appendChild(option);
                    });
                }
            });
            
            console.log('Filters populated - Colleges:', colleges.length, 'Programs:', programs.length);
            
            // Update statistics with TOTAL programs (not unique)
            updateStatistics(data, colleges, programs);
            
            // Create dynamic filter buttons based on actual data
            createDynamicFilterButtons(data);
            
            // Update search placeholder with helpful hints
            const searchInput = document.getElementById('searchInput');
            const hints = [
                'Search colleges or programs...',
                'Try "Computer Science", "B.Com", "Hons"...',
                'Search by degree type or college name...',
                'Example: "Delhi College" or "Physics"...'
            ];
            let hintIndex = 0;
            
            setInterval(() => {
                if (!searchInput.value) {
                    searchInput.placeholder = hints[hintIndex];
                    hintIndex = (hintIndex + 1) % hints.length;
                }
            }, 3000);
            
            console.log(` Filters populated: ${colleges.length} unique colleges, ${programs.length} unique programs, ${data.length} total records`);
        }
        
        // Update statistics with proper counts
        function updateStatistics(data, uniqueColleges, uniquePrograms) {
            // Calculate total seats from raw CSV data
            let totalSeats = 0;
            
            data.forEach(row => {
                totalSeats += (parseInt(row.UR) || 0) + (parseInt(row.OBC) || 0) + (parseInt(row.SC) || 0) + 
                             (parseInt(row.ST) || 0) + (parseInt(row.EWS) || 0) + (parseInt(row.SIKH) || 0) + 
                             (parseInt(row.PwBD) || 0);
            });
            
            // Update statistics with real data
            document.getElementById('totalColleges').textContent = uniqueColleges.length;
            document.getElementById('totalPrograms').textContent = data.length; // TOTAL programs, not unique
            document.getElementById('totalSeats').textContent = totalSeats.toLocaleString();
            document.getElementById('avgSeats').textContent = totalSeats > 0 ? Math.round(totalSeats / data.length) : 0;
            
            console.log(` Statistics: ${uniqueColleges.length} colleges, ${data.length} total programs (${uniquePrograms.length} unique), ${totalSeats} total seats`);
        }
        
        // Create dynamic filter buttons based on actual program data
        function createDynamicFilterButtons(data) {
            const filterContainer = document.getElementById('dynamicFilterButtons');
            const programTypes = new Map();
            
            // Analyze actual programs to determine filter types
            data.forEach(record => {
                const program = record['NAME OF THE PROGRAM'] || '';
                if (program.includes('B.Com')) {
                    programTypes.set('bcom', { label: 'B.Com', count: (programTypes.get('bcom')?.count || 0) + 1 });
                }
                if (program.includes('B.Sc')) {
                    programTypes.set('bsc', { label: 'B.Sc', count: (programTypes.get('bsc')?.count || 0) + 1 });
                }
                if (program.includes('B.A')) {
                    programTypes.set('ba', { label: 'B.A', count: (programTypes.get('ba')?.count || 0) + 1 });
                }
                if (program.includes('(Hons.)') || program.includes('Hons')) {
                    programTypes.set('honours', { label: 'Honours', count: (programTypes.get('honours')?.count || 0) + 1 });
                }
                if (program.includes('Program')) {
                    programTypes.set('program', { label: 'Program', count: (programTypes.get('program')?.count || 0) + 1 });
                }
                if (program.includes('Bachelor Of Elementary Education')) {
                    programTypes.set('beled', { label: 'B.El.Ed', count: (programTypes.get('beled')?.count || 0) + 1 });
                }
                if (program.includes('Bachelor Of Management Studies')) {
                    programTypes.set('bms', { label: 'BMS', count: (programTypes.get('bms')?.count || 0) + 1 });
                }
            });
            
            // Create buttons HTML
            let buttonsHTML = '<button class="btn filter-btn active" onclick="filterByType(\'all\')">All Programs</button>';
            
            // Add buttons for each found program type
            programTypes.forEach((data, type) => {
                buttonsHTML += `<button class="btn filter-btn" onclick="filterByType('${type}')">${data.label} <span class="badge bg-light text-dark ms-1">${data.count}</span></button>`;
            });
            
            filterContainer.innerHTML = buttonsHTML;
            console.log(` Created ${programTypes.size + 1} dynamic filter buttons`);
        }
        
        // Clear all filters function
        function clearAllFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('collegeFilter').value = '';
            document.getElementById('programFilter').value = '';
            document.getElementById('sortBy').value = '';
            
            // Reset filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.filter-btn[onclick*="all"]')?.classList.add('active');
            
            // Clear search suggestions
            hideSearchSuggestions();
            
            filterData();
        }

        // Debounce function for search
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Update display with chart data
        function updateDisplay(chartDataToUse) {
            console.log(' Updating display with chart data:', chartDataToUse);
            
            if (!chartDataToUse) {
                console.warn(' No chart data provided to updateDisplay');
                return;
            }
            
            // Update summary cards with real data
            if (chartDataToUse.summary_cards) {
                const cards = document.querySelectorAll('.summary-cards .card');
                console.log(' Found', cards.length, 'summary cards to update');
                
                chartDataToUse.summary_cards.forEach((card, index) => {
                    if (cards[index]) {
                        const valueElement = cards[index].querySelector('h3');
                        const titleElement = cards[index].querySelector('p');
                        if (valueElement) {
                            valueElement.textContent = card.value;
                            console.log(` Updated card ${index}:`, card.title, '=', card.value);
                        }
                        if (titleElement) titleElement.textContent = card.title;
                    }
                });
            }
            
            // Store chart data globally for chart functions to use
            chartData = chartDataToUse;
            
            // Update individual charts with error handling
            try {
                if (chartDataToUse.college_bar) {
                    console.log(' Updating college chart data...');
                    renderCollegeChart();
                }
            } catch (error) {
                console.error(' Error updating college chart:', error);
            }
            
            try {
                if (chartDataToUse.category_pie) {
                    console.log(' Updating category chart data...');
                    renderCategoryChart();
                }
            } catch (error) {
                console.error(' Error updating category chart:', error);
            }
            
            try {
                if (chartDataToUse.program_bar) {
                    console.log(' Updating program chart data...');
                    renderProgramChart();
                }
            } catch (error) {
                console.error(' Error updating program chart:', error);
            }
            
            // Auto-render trend chart with admission data
            try {
                console.log(' Auto-rendering trend chart...');
                setTimeout(() => renderTrendChart(), 1000); // Delay to ensure data is ready
            } catch (error) {
                console.error(' Error auto-rendering trend chart:', error);
            }
        }

        // Convert analytics data to table format
        function convertAnalyticsToTableData(programList) {
            const tableData = [];
            
            if (Array.isArray(programList)) {
                programList.forEach(item => {
                    if (typeof item === 'string' && item.includes('@{')) {
                        // Parse PowerShell hash table format for all fields
                        const match = item.match(/@\{NAME OF THE PROGRAM=([^;]+);\s*total_seats=(\d+);\s*instances=(\d+);\s*avg_seats_per_instance=([^;]+);\s*college_count=(\d+);\s*UR=(\d+);\s*OBC=(\d+);\s*SC=(\d+);\s*ST=(\d+);\s*EWS=(\d+);\s*SIKH=(\d+);\s*PwBD=(\d+);\s*program_type=([^;]+);\s*program_level=([^}]+)/);
                        if (match) {
                            const row = {
                                'NAME OF THE PROGRAM': match[1].trim(),
                                'NAME OF THE COLLEGE': 'Multiple Colleges', // Since this is aggregated data
                                'TOTAL SEATS': parseInt(match[2]),
                                'INSTANCES': parseInt(match[3]),
                                'COLLEGE COUNT': parseInt(match[5]),
                                'UR': parseInt(match[6]),
                                'OBC': parseInt(match[7]),
                                'SC': parseInt(match[8]),
                                'ST': parseInt(match[9]),
                                'EWS': parseInt(match[10]),
                                'SIKH': parseInt(match[11]),
                                'PwBD': parseInt(match[12]),
                                'PROGRAM TYPE': match[13].trim(),
                                'PROGRAM LEVEL': match[14].trim()
                            };
                            tableData.push(row);
                        }
                    }
                });
            }
            
            return tableData;
        }

        // Load dashboard data
        async function loadDashboardData() {
            showLoading(true);
            
            try {
                console.log(' Loading raw CSV data from API...');
                const rawDataResponse = await fetch('/api/raw-data');
                
                if (rawDataResponse.ok) {
                    admissionData = await rawDataResponse.json();
                    console.log(' Loaded raw CSV data:', admissionData.length, 'rows');
                    console.log('Sample data row:', admissionData[0]);
                    
                    // Generate chart data from raw CSV data
                    chartData = generateChartsFromRawData(admissionData);
                    console.log(' Generated chart data from raw CSV:', chartData);
                    
                    // Update dashboard with real data
                    updateStatistics();
                    populateDataTable(admissionData, currentPage, itemsPerPage);
                    populateFilters(admissionData);
                    updateResultCount(admissionData.length);
                    updateDisplay(chartData);
                    showDashboard();
                    
                    // Show vacancy analysis section
                    document.getElementById('vacancyAnalysisSection').style.display = 'block';
                    
                    // Show advanced analysis section
                    document.getElementById('advancedAnalysisSection').style.display = 'block';
                    
                    // Load vacancy analysis
                    loadVacancyAnalysis();
                    
                    // Load college analysis by default
                    loadCollegeAnalysis();
                    
                } else {
                    console.error(' Failed to load raw data');
                    loadDemoData();
                }
                
            } catch (error) {
                console.error(' Error loading dashboard data:', error);
                console.log(' Loading demo data as fallback...');
                loadDemoData();
            } finally {
                showLoading(false);
            }
        }

        // Generate chart data from advanced analytics
        function generateChartsFromAnalytics(analytics) {
            console.log(' Generating charts from analytics:', analytics);
            const charts = {};
            
            // Generate summary cards from overview
            if (analytics.overview) {
                const overview = analytics.overview;
                charts.summary_cards = [
                    { title: 'Total Colleges', value: overview.total_colleges?.toString() || '0' },
                    { title: 'Total Programs', value: overview.total_programs?.toString() || '0' },
                    { title: 'Total Seats', value: overview.total_seats?.toString() || '0' },
                    { title: 'Avg Seats/Program', value: Math.round(overview.avg_seats_per_program || 0).toString() }
                ];
            } else {
                // Fallback summary cards
                charts.summary_cards = [
                    { title: 'Total Colleges', value: '0' },
                    { title: 'Total Programs', value: '0' },
                    { title: 'Total Seats', value: '0' },
                    { title: 'Avg Seats/Program', value: '0' }
                ];
            }
            
            // Generate college chart
            if (analytics.categories && analytics.categories.top_colleges_by_category && analytics.categories.top_colleges_by_category.UR) {
                // Parse the top colleges from the UR category as it has the most comprehensive data
                const urCollegeData = analytics.categories.top_colleges_by_category.UR;
                console.log(' Raw college data:', urCollegeData);
                
                const colleges = [];
                if (typeof urCollegeData === 'string') {
                    // Remove @{ and } wrappers and split by semicolon
                    const cleanData = urCollegeData.replace(/^@\{|\}$/g, '');
                    const entries = cleanData.split(/;\s*/);
                    
                    entries.forEach(entry => {
                        if (entry.trim()) {
                            // Split by equals sign
                            const parts = entry.split('=');
                            if (parts.length === 2) {
                                const name = parts[0].trim();
                                const seats = parseInt(parts[1].trim());
                                if (!isNaN(seats)) {
                                    colleges.push({ college: name, total_seats: seats });
                                }
                            }
                        }
                    });
                }
                
                if (colleges.length > 0) {
                    const topColleges = colleges.slice(0, 10);
                    charts.college_bar = {
                        labels: topColleges.map(c => c.college),
                        data: topColleges.map(c => c.total_seats)
                    };
                    console.log(' College chart data generated:', charts.college_bar);
                } else {
                    charts.college_bar = {
                        labels: ['No Data Available'],
                        data: [0]
                    };
                }
            } else if (analytics.colleges && analytics.colleges.top_by_seats && analytics.colleges.top_by_seats.length > 0) {
                const topColleges = analytics.colleges.top_by_seats.slice(0, 10);
                // Handle the string format from PowerShell
                const collegeData = topColleges.map(c => {
                    if (typeof c === 'string') {
                        // Parse PowerShell object string format
                        const match = c.match(/college=([^;]+).*total_seats=(\d+)/);
                        if (match) {
                            return { college: match[1], total_seats: parseInt(match[2]) };
                        }
                    }
                    return c; // Already an object
                });
                
                charts.college_bar = {
                    labels: collegeData.map(c => c.college || 'Unknown'),
                    data: collegeData.map(c => c.total_seats || 0)
                };
                console.log(' College chart data generated:', charts.college_bar);
            } else {
                // Fallback college data
                charts.college_bar = {
                    labels: ['No Data Available'],
                    data: [0]
                };
                console.log(' No college data available, using fallback');
            }
            
            // Generate category chart
            if (analytics.categories && analytics.categories.totals) {
                const categories = analytics.categories.totals;
                const categoryKeys = Object.keys(categories);
                if (categoryKeys.length > 0) {
                    charts.category_pie = {
                        labels: categoryKeys,
                        data: Object.values(categories)
                    };
                    console.log(' Category chart data generated:', charts.category_pie);
                } else {
                    charts.category_pie = {
                        labels: ['No Data'],
                        data: [0]
                    };
                }
            } else {
                charts.category_pie = {
                    labels: ['No Data'],
                    data: [0]
                };
                console.log(' No category data available, using fallback');
            }
            
            // Generate program chart
            if (analytics.programs && analytics.programs.top_by_seats && analytics.programs.top_by_seats.length > 0) {
                const topPrograms = analytics.programs.top_by_seats.slice(0, 10);
                console.log(' Raw program data:', topPrograms);
                
                // Handle the string format from PowerShell
                const programData = topPrograms.map(p => {
                    if (typeof p === 'string') {
                        // Parse PowerShell object string format
                        const match = p.match(/@\{NAME OF THE PROGRAM=([^;]+);\s*total_seats=(\d+);/);
                        if (match) {
                            return { program: match[1].trim(), total_seats: parseInt(match[2]) };
                        }
                    }
                    return p; // Already an object
                });
                
                // Filter out any invalid entries
                const validPrograms = programData.filter(p => p && p.program && !isNaN(p.total_seats));
                
                if (validPrograms.length > 0) {
                    charts.program_bar = {
                        labels: validPrograms.map(p => p.program),
                        data: validPrograms.map(p => p.total_seats)
                    };
                    console.log(' Program chart data generated:', charts.program_bar);
                } else {
                    charts.program_bar = {
                        labels: ['No Data Available'],
                        data: [0]
                    };
                }
            } else {
                charts.program_bar = {
                    labels: ['No Data Available'],
                    data: [0]
                };
                console.log(' No program data available, using fallback');
            }
            
            return charts;
        }

        // Generate chart data from raw CSV data
        function generateChartsFromRawData(rawData) {
            console.log(' Generating charts from raw CSV data:', rawData.length, 'rows');
            const charts = {};
            
            if (!rawData || rawData.length === 0) {
                console.warn(' No raw data available for chart generation');
                return {
                    summary_cards: [
                        { title: 'Total Colleges', value: '0' },
                        { title: 'Total Programs', value: '0' },
                        { title: 'Total Seats', value: '0' },
                        { title: 'Avg Seats/Program', value: '0' }
                    ],
                    college_bar: { labels: ['No Data'], data: [0] },
                    category_pie: { labels: ['No Data'], data: [0] },
                    program_bar: { labels: ['No Data'], data: [0] }
                };
            }

            // Calculate summary statistics
            const totalColleges = new Set(rawData.map(row => row['NAME OF THE COLLEGE'])).size;
            const totalPrograms = rawData.length;
            const totalSeats = rawData.reduce((sum, row) => {
                return sum + (parseInt(row.UR) || 0) + (parseInt(row.OBC) || 0) + 
                       (parseInt(row.SC) || 0) + (parseInt(row.ST) || 0) + 
                       (parseInt(row.EWS) || 0) + (parseInt(row.SIKH) || 0) + 
                       (parseInt(row.PwBD) || 0);
            }, 0);
            const avgSeatsPerProgram = Math.round(totalSeats / totalPrograms);

            charts.summary_cards = [
                { title: 'Total Colleges', value: totalColleges.toString() },
                { title: 'Total Programs', value: totalPrograms.toString() },
                { title: 'Total Seats', value: totalSeats.toString() },
                { title: 'Avg Seats/Program', value: avgSeatsPerProgram.toString() }
            ];

            // Generate college bar chart data (top 10 colleges by total seats)
            const collegeSeats = {};
            rawData.forEach(row => {
                const college = row['NAME OF THE COLLEGE'];
                const seats = (parseInt(row.UR) || 0) + (parseInt(row.OBC) || 0) + 
                             (parseInt(row.SC) || 0) + (parseInt(row.ST) || 0) + 
                             (parseInt(row.EWS) || 0) + (parseInt(row.SIKH) || 0) + 
                             (parseInt(row.PwBD) || 0);
                collegeSeats[college] = (collegeSeats[college] || 0) + seats;
            });
            
            const topColleges = Object.entries(collegeSeats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
                
            charts.college_bar = {
                labels: topColleges.map(c => c[0]),
                data: topColleges.map(c => c[1])
            };

            // Generate category pie chart data (reservation categories)
            const categoryTotals = {
                'UR': 0, 'OBC': 0, 'SC': 0, 'ST': 0, 'EWS': 0, 'SIKH': 0, 'PwBD': 0
            };
            
            rawData.forEach(row => {
                categoryTotals.UR += parseInt(row.UR) || 0;
                categoryTotals.OBC += parseInt(row.OBC) || 0;
                categoryTotals.SC += parseInt(row.SC) || 0;
                categoryTotals.ST += parseInt(row.ST) || 0;
                categoryTotals.EWS += parseInt(row.EWS) || 0;
                categoryTotals.SIKH += parseInt(row.SIKH) || 0;
                categoryTotals.PwBD += parseInt(row.PwBD) || 0;
            });

            charts.category_pie = {
                labels: Object.keys(categoryTotals),
                data: Object.values(categoryTotals)
            };

            // Generate program bar chart data (top 10 programs by total seats)
            const programSeats = {};
            rawData.forEach(row => {
                const program = row['NAME OF THE PROGRAM'];
                const seats = (parseInt(row.UR) || 0) + (parseInt(row.OBC) || 0) + 
                             (parseInt(row.SC) || 0) + (parseInt(row.ST) || 0) + 
                             (parseInt(row.EWS) || 0) + (parseInt(row.SIKH) || 0) + 
                             (parseInt(row.PwBD) || 0);
                programSeats[program] = (programSeats[program] || 0) + seats;
            });
            
            const topPrograms = Object.entries(programSeats)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
                
            charts.program_bar = {
                labels: topPrograms.map(p => p[0]),
                data: topPrograms.map(p => p[1])
            };

            // Generate trend line data (category-wise distribution)
            const trendLabels = Object.keys(categoryTotals);
            const trendData = Object.values(categoryTotals);
            
            charts.trend_line = {
                labels: trendLabels,
                data: trendData
            };

            console.log(' Chart data generated from raw CSV:', charts);
            return charts;
        }

        // Load demo data when no process is available
        function loadDemoData() {
            console.log(' Loading demo data for visualization...');
            
            // Set demo statistics
            document.getElementById('totalColleges').textContent = '83';
            document.getElementById('totalPrograms').textContent = '176';
            document.getElementById('totalSeats').textContent = '16,019';
            document.getElementById('avgSeats').textContent = '91';
            
            // Create demo chart data
            chartData = {
                summary_cards: [
                    { title: 'Total Colleges', value: '83' },
                    { title: 'Total Programs', value: '176' },
                    { title: 'Total Seats', value: '16019' },
                    { title: 'Processing Efficiency', value: '100%' }
                ],
                college_bar: {
                    labels: ['Hindu College', 'Lady Shri Ram College', 'Ramjas College', 'Hansraj College', 'Miranda House'],
                    data: [500, 480, 460, 440, 420]
                },
                category_pie: {
                    labels: ['UR', 'OBC', 'SC', 'ST', 'EWS'],
                    data: [7500, 4200, 2400, 1200, 719]
                }
            };
            
            showDashboard();
            updateStatistics();
            
            // Use updateDisplay for consistent chart handling
            updateDisplay(chartData);
        }

        // Update advanced statistics from analytics data
        function updateAdvancedStatistics() {
            if (!advancedAnalytics || !advancedAnalytics.overview) {
                console.log(' No advanced analytics data available');
                return;
            }

            const overview = advancedAnalytics.overview;
            
            // Update main statistics with real data
            document.getElementById('totalColleges').textContent = overview.total_colleges?.toLocaleString() || '0';
            document.getElementById('totalPrograms').textContent = overview.total_programs?.toLocaleString() || '0';
            document.getElementById('totalSeats').textContent = overview.total_seats?.toLocaleString() || '0';
            document.getElementById('avgSeats').textContent = Math.round(overview.avg_seats_per_program || 0).toString();
            
            console.log(' Advanced statistics updated:', {
                colleges: overview.total_colleges,
                programs: overview.total_programs, 
                seats: overview.total_seats,
                efficiency: overview.data_quality?.processing_method
            });

            // Add insights display
            displayAdvancedInsights();
        }

        // Display advanced insights
        function displayAdvancedInsights() {
            if (!advancedAnalytics || !advancedAnalytics.insights) return;

            const insightsContainer = document.getElementById('insightsContainer');
            if (!insightsContainer) return;

            let insightsHTML = '<div class="advanced-insights mt-4">';
            insightsHTML += '<h5 class="mb-3"><i class="fas fa-lightbulb text-warning"></i> Advanced Insights</h5>';
            
            advancedAnalytics.insights.forEach(insight => {
                insightsHTML += `
                    <div class="insight-card mb-2 p-3 border rounded bg-light">
                        <div class="d-flex align-items-center">
                            <span class="me-2">${insight.icon}</span>
                            <div>
                                <strong>${insight.title}</strong>
                                <p class="mb-0 small text-muted">${insight.description}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            insightsHTML += '</div>';
            insightsContainer.innerHTML = insightsHTML;
        }

        // Update statistics cards
        function updateStatistics() {
            console.log(' Updating statistics...');
            console.log(' Chart data available:', !!chartData);
            console.log(' Summary cards:', chartData?.summary_cards);
            
            if (!chartData || !chartData.summary_cards || !Array.isArray(chartData.summary_cards)) {
                console.warn(' No summary data available');
                return;
            }

            const cards = chartData.summary_cards;
            console.log(' Processing summary cards:', cards);
            
            // Map the card data by title for easy access
            const statsMap = {};
            cards.forEach(card => {
                statsMap[card.title] = card.value;
            });
            
            console.log(' Stats map:', statsMap);
            
            // Update the dashboard statistics with animation
            const elements = {
                'totalColleges': statsMap['Total Colleges'] || '0',
                'totalPrograms': statsMap['Total Programs'] || '0', 
                'totalSeats': statsMap['Total Seats'] || '0',
                'avgSeats': Math.round(parseInt(statsMap['Total Seats'] || 0) / parseInt(statsMap['Total Programs'] || 1))
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                    console.log(` Updated ${id}: ${value}`);
                } else {
                    console.error(` Element not found: ${id}`);
                }
            });
            
            console.log(' Statistics update complete');
        }

        // Render college chart
        function renderCollegeChart() {
            const btn = document.getElementById('collegeChartBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            setTimeout(() => {
                try {
                    const ctx = document.getElementById('collegeChart').getContext('2d');
                    
                    if (charts.college) {
                        charts.college.destroy();
                    }

                    const collegeData = chartData.college_bar || { labels: [], datasets: [] };
                    
                    charts.college = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: collegeData.labels || [],
                            datasets: [{
                                label: 'Available Seats',
                                data: collegeData.data || [],
                                backgroundColor: 'rgba(59, 130, 246, 0.8)',
                                borderColor: 'rgba(59, 130, 246, 1)',
                                borderWidth: 2,
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: false
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.1)'
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    }
                                }
                            }
                        }
                    });

                    console.log(' College chart rendered');
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    btn.style.background = '#10b981';
                    
                } catch (error) {
                    console.error(' Error rendering college chart:', error);
                    btn.innerHTML = '<i class="fas fa-exclamation"></i>';
                    btn.style.background = '#ef4444';
                }
            }, 500);
        }

        // Render program chart
        function renderProgramChart() {
            const btn = document.getElementById('programChartBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            setTimeout(() => {
                try {
                    const ctx = document.getElementById('programChart').getContext('2d');
                    
                    if (charts.program) {
                        charts.program.destroy();
                    }

                    // Use program_bar data for the doughnut chart
                    const programData = chartData.program_bar || { labels: [], data: [] };
                    
                    charts.program = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: programData.labels || [],
                            datasets: [{
                                data: programData.data || [],
                                backgroundColor: [
                                    '#3b82f6', '#10b981', '#f59e0b', '#ef4444',
                                    '#8b5cf6', '#06b6d4', '#84cc16', '#f97316',
                                    '#ec4899', '#14b8a6'
                                ],
                                borderWidth: 2,
                                borderColor: '#ffffff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        usePointStyle: true,
                                        padding: 15,
                                        font: {
                                            size: 11
                                        }
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            const label = context.label || '';
                                            const value = context.parsed || 0;
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = ((value / total) * 100).toFixed(1);
                                            return `${label}: ${value} seats (${percentage}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    console.log(' Program chart rendered with data:', programData.labels?.length || 0, 'programs');
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    btn.style.background = '#10b981';
                    
                } catch (error) {
                    console.error(' Error rendering program chart:', error);
                    btn.innerHTML = '<i class="fas fa-exclamation"></i>';
                    btn.style.background = '#ef4444';
                }
            }, 500);
        }

        // Render category chart
        function renderCategoryChart() {
            const btn = document.getElementById('categoryChartBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            setTimeout(() => {
                try {
                    const ctx = document.getElementById('categoryChart').getContext('2d');
                    
                    if (charts.category) {
                        charts.category.destroy();
                    }

                    const categoryData = chartData.category_pie || { labels: [], datasets: [] };
                    
                    charts.category = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: categoryData.labels || [],
                            datasets: [{
                                data: categoryData.data || [],
                                backgroundColor: [
                                    '#3b82f6', '#10b981', '#f59e0b', '#ef4444',
                                    '#8b5cf6', '#06b6d4', '#84cc16'
                                ],
                                borderWidth: 2,
                                borderColor: '#ffffff'
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom'
                                }
                            }
                        }
                    });

                    console.log(' Category chart rendered');
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    btn.style.background = '#10b981';
                    
                } catch (error) {
                    console.error(' Error rendering category chart:', error);
                    btn.innerHTML = '<i class="fas fa-exclamation"></i>';
                    btn.style.background = '#ef4444';
                }
            }, 500);
        }

        // Render enhanced trend chart
        function renderTrendChart() {
            const btn = document.getElementById('trendChartBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            setTimeout(() => {
                try {
                    const ctx = document.getElementById('trendChart').getContext('2d');
                    
                    if (charts.trend) {
                        charts.trend.destroy();
                    }

                    // Generate enhanced trend data based on actual admission data
                    const trendData = generateTrendAnalysis();
                    
                    console.log(' Enhanced trend data:', trendData);
                    
                    charts.trend = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: trendData.labels,
                            datasets: [{
                                label: 'Total Seats',
                                data: trendData.totalSeats,
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                borderWidth: 3,
                                fill: false,
                                tension: 0.4,
                                pointBackgroundColor: '#3b82f6',
                                pointBorderColor: '#1d4ed8',
                                pointRadius: 6
                            }, {
                                label: 'UR Seats',
                                data: trendData.urSeats,
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 2,
                                fill: false,
                                tension: 0.4,
                                pointBackgroundColor: '#10b981',
                                pointRadius: 4
                            }, {
                                label: 'OBC Seats',
                                data: trendData.obcSeats,
                                borderColor: '#f59e0b',
                                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                                borderWidth: 2,
                                fill: false,
                                tension: 0.4,
                                pointBackgroundColor: '#f59e0b',
                                pointRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top',
                                    labels: {
                                        usePointStyle: true,
                                        font: {
                                            size: 12
                                        }
                                    }
                                },
                                title: {
                                    display: true,
                                    text: 'Seats Distribution Trend Analysis',
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.1)'
                                    },
                                    title: {
                                        display: true,
                                        text: 'Number of Seats'
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    },
                                    title: {
                                        display: true,
                                        text: 'College Categories (by Seat Count)'
                                    }
                                }
                            },
                            interaction: {
                                intersect: false,
                                mode: 'index'
                            }
                        }
                    });

                    console.log(' Enhanced trend chart rendered successfully');
                    btn.innerHTML = '<i class="fas fa-check"></i>';
                    btn.style.background = '#10b981';
                    
                } catch (error) {
                    console.error(' Error rendering trend chart:', error);
                    btn.innerHTML = '<i class="fas fa-exclamation"></i>';
                    btn.style.background = '#ef4444';
                }
            }, 500);
        }

        // Generate meaningful trend analysis from admission data
        function generateTrendAnalysis() {
            if (!admissionData || admissionData.length === 0) {
                console.warn(' No admission data available for trend analysis');
                return {
                    labels: ['No Data'],
                    totalSeats: [0],
                    urSeats: [0],
                    obcSeats: [0]
                };
            }

            // Group colleges by their total seat capacity
            const collegeCapacities = {};
            
            admissionData.forEach(row => {
                const college = row['NAME OF THE COLLEGE'];
                const ur = parseInt(row.UR) || 0;
                const obc = parseInt(row.OBC) || 0;
                const sc = parseInt(row.SC) || 0;
                const st = parseInt(row.ST) || 0;
                const ews = parseInt(row.EWS) || 0;
                const sikh = parseInt(row.SIKH) || 0;
                const pwbd = parseInt(row.PwBD) || 0;
                const total = ur + obc + sc + st + ews + sikh + pwbd;

                if (!collegeCapacities[college]) {
                    collegeCapacities[college] = {
                        total: 0,
                        ur: 0,
                        obc: 0,
                        sc: 0,
                        st: 0,
                        ews: 0,
                        sikh: 0,
                        pwbd: 0
                    };
                }

                collegeCapacities[college].total += total;
                collegeCapacities[college].ur += ur;
                collegeCapacities[college].obc += obc;
                collegeCapacities[college].sc += sc;
                collegeCapacities[college].st += st;
                collegeCapacities[college].ews += ews;
                collegeCapacities[college].sikh += sikh;
                collegeCapacities[college].pwbd += pwbd;
            });

            // Sort colleges by total capacity and take top 10
            const sortedColleges = Object.entries(collegeCapacities)
                .sort((a, b) => b[1].total - a[1].total)
                .slice(0, 10);

            const labels = sortedColleges.map(([college, data]) => {
                // Truncate college names for better display
                return college.length > 20 ? college.substring(0, 17) + '...' : college;
            });
            
            const totalSeats = sortedColleges.map(([college, data]) => data.total);
            const urSeats = sortedColleges.map(([college, data]) => data.ur);
            const obcSeats = sortedColleges.map(([college, data]) => data.obc);

            return {
                labels,
                totalSeats,
                urSeats,
                obcSeats
            };
        }

        // Enhanced search functionality with auto-scroll
        function handleSearch() {
            const query = document.getElementById('searchInput').value;
            const searchIndicator = document.getElementById('searchIndicator');
            
            // Show search indicator
            if (query.trim()) {
                if (!searchIndicator) {
                    // Create search indicator if it doesn't exist
                    const indicator = document.createElement('div');
                    indicator.id = 'searchIndicator';
                    indicator.className = 'search-indicator alert alert-info';
                    indicator.innerHTML = `
                        <div class="d-flex align-items-center">
                            <i class="fas fa-search me-2"></i>
                            <span id="searchText">Searching...</span>
                            <button class="btn btn-sm btn-outline-primary ms-auto" onclick="clearSearch()">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    `;
                    
                    // Insert before the table
                    const tableContainer = document.querySelector('.data-table');
                    tableContainer.insertBefore(indicator, tableContainer.firstChild);
                }
                
                // Update search text
                document.getElementById('searchText').textContent = `Searching for: "${query}"`;
                document.getElementById('searchIndicator').style.display = 'block';
            } else {
                // Hide search indicator when no query
                if (searchIndicator) {
                    searchIndicator.style.display = 'none';
                }
            }
            
            filterData();
            
            // Auto-scroll to table if search has content
            if (query.trim()) {
                const tableSection = document.getElementById('admissionTable') || document.querySelector('.table-responsive');
                if (tableSection) {
                    tableSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                    
                    // Add a subtle highlight effect to show where results are
                    tableSection.style.transition = 'all 0.3s ease';
                    tableSection.style.backgroundColor = '#f8f9fa';
                    tableSection.style.border = '2px solid #007bff';
                    tableSection.style.borderRadius = '8px';
                    
                    // Remove highlight after 2 seconds
                    setTimeout(() => {
                        tableSection.style.backgroundColor = '';
                        tableSection.style.border = '';
                        tableSection.style.borderRadius = '';
                    }, 2000);
                }
                
                // Show toast notification about results with enhanced feedback
                setTimeout(() => {
                    const tableRows = document.querySelectorAll('#dataTableBody tr:not(.table-totals-row)');
                    const filteredCount = Array.from(tableRows).filter(row => 
                        !row.textContent.includes('No results found') && 
                        !row.textContent.includes('Displaying all')
                    ).length;
                    
                    // Update search indicator with results
                    const searchText = document.getElementById('searchText');
                    if (searchText) {
                        if (filteredCount > 0) {
                            searchText.innerHTML = `
                                <i class="fas fa-check-circle text-success me-1"></i>
                                Found <strong>${filteredCount}</strong> results for "${query}"
                            `;
                            document.getElementById('searchIndicator').className = 'search-indicator alert alert-success';
                        } else {
                            searchText.innerHTML = `
                                <i class="fas fa-exclamation-triangle text-warning me-1"></i>
                                No results found for "${query}"
                            `;
                            document.getElementById('searchIndicator').className = 'search-indicator alert alert-warning';
                        }
                    }
                    
                    if (filteredCount > 0) {
                        showToast(` Found ${filteredCount} results for "${query}"`, 'success');
                    } else {
                        showToast(` No results found for "${query}". Try different keywords.`, 'warning');
                    }
                }, 100);
            }
        }
        
        // Clear search function
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            const searchIndicator = document.getElementById('searchIndicator');
            if (searchIndicator) {
                searchIndicator.style.display = 'none';
            }
            filterData();
            showToast(' Search cleared', 'info');
        }
        
        // Toast notification system
        function showToast(message, type = 'info') {
            // Remove existing toast if any
            const existingToast = document.querySelector('.custom-toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = `custom-toast alert alert-${type === 'success' ? 'success' : (type === 'warning' ? 'warning' : 'info')} alert-dismissible`;
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                animation: slideInRight 0.3s ease;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                border-left: 4px solid ${type === 'success' ? '#28a745' : (type === 'warning' ? '#ffc107' : '#007bff')};
            `;
            
            toast.innerHTML = `
                <strong>${type === 'success' ? '' : (type === 'warning' ? '' : '')}</strong> ${message}
                <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
            `;
            
            // Add CSS animation keyframes if not already added
            if (!document.querySelector('#toast-animations')) {
                const style = document.createElement('style');
                style.id = 'toast-animations';
                style.textContent = `
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideOutRight {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            document.body.appendChild(toast);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }
            }, 4000);
        }
        
        // Filter data based on search and all filters
        function filterData() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const college = document.getElementById('collegeFilter').value;
            const program = document.getElementById('programFilter').value;
            const sortBy = document.getElementById('sortBy').value;
            
            let filtered = [...admissionData];

            // Advanced text search filter
            if (searchTerm) {
                filtered = filtered.filter(row => {
                    const collegeName = (row['NAME OF THE COLLEGE'] || '').toLowerCase();
                    const programName = (row['NAME OF THE PROGRAM'] || '').toLowerCase();
                    
                    // Direct match
                    if (collegeName.includes(searchTerm) || programName.includes(searchTerm)) {
                        return true;
                    }
                    
                    // Split search term for multi-word search
                    const searchWords = searchTerm.split(' ').filter(word => word.length > 1);
                    if (searchWords.length > 1) {
                        return searchWords.every(word => 
                            collegeName.includes(word) || programName.includes(word)
                        );
                    }
                    
                    // Abbreviation search (e.g., "DU" for "Delhi University")
                    if (searchTerm.length <= 3) {
                        const collegeAbbr = collegeName.split(' ').map(word => word[0]).join('');
                        const programAbbr = programName.split(' ').map(word => word[0]).join('');
                        return collegeAbbr.includes(searchTerm) || programAbbr.includes(searchTerm);
                    }
                    
                    return false;
                });
            }

            // College filter
            if (college) {
                filtered = filtered.filter(row => 
                    row['NAME OF THE COLLEGE'] === college
                );
            }

            // Program filter
            if (program) {
                filtered = filtered.filter(row => 
                    row['NAME OF THE PROGRAM'] === program
                );
            }

            // Category filter (show only records with seats in selected category)
            if (category) {
                filtered = filtered.filter(row => 
                    row[category] && parseInt(row[category]) > 0
                );
            }

            // Sorting
            if (sortBy) {
                filtered.sort((a, b) => {
                    switch(sortBy) {
                        case 'college':
                            return a['NAME OF THE COLLEGE'].localeCompare(b['NAME OF THE COLLEGE']);
                        case 'program':
                            return a['NAME OF THE PROGRAM'].localeCompare(b['NAME OF THE PROGRAM']);
                        case 'total_seats':
                            const totalA = (parseInt(a.UR) || 0) + (parseInt(a.OBC) || 0) + (parseInt(a.SC) || 0) + (parseInt(a.ST) || 0) + (parseInt(a.EWS) || 0) + (parseInt(a.SIKH) || 0) + (parseInt(a.PwBD) || 0);
                            const totalB = (parseInt(b.UR) || 0) + (parseInt(b.OBC) || 0) + (parseInt(b.SC) || 0) + (parseInt(b.ST) || 0) + (parseInt(b.EWS) || 0) + (parseInt(b.SIKH) || 0) + (parseInt(b.PwBD) || 0);
                            return totalB - totalA; // Descending order
                        case 'ur_seats':
                            return (parseInt(b.UR) || 0) - (parseInt(a.UR) || 0); // Descending order
                        case 'obc_seats':
                            return (parseInt(b.OBC) || 0) - (parseInt(a.OBC) || 0); // Descending order
                        case 'sc_seats':
                            return (parseInt(b.SC) || 0) - (parseInt(a.SC) || 0); // Descending order
                        case 'st_seats':
                            return (parseInt(b.ST) || 0) - (parseInt(a.ST) || 0); // Descending order
                        case 'ews_seats':
                            return (parseInt(b.EWS) || 0) - (parseInt(a.EWS) || 0); // Descending order
                        case 'sikh_seats':
                            return (parseInt(b.SIKH) || 0) - (parseInt(a.SIKH) || 0); // Descending order
                        case 'pwbd_seats':
                            return (parseInt(b.PwBD) || 0) - (parseInt(a.PwBD) || 0); // Descending order
                        default:
                            return 0;
                    }
                });
            }

            // Store filtered data and update state
            filteredData = filtered;
            isSearchActive = searchTerm || category || college || program;
            currentPage = 1;
            
            // Show search results indicator and scroll to table if search is active
            if (isSearchActive) {
                showSearchResultsIndicator(searchTerm, filtered.length);
                scrollToTable();
            } else {
                hideSearchResultsIndicator();
            }

            populateDataTable(filtered, currentPage, isPaginationEnabled ? itemsPerPage : Infinity);
            updateResultCount(filtered.length);
        }
        
        // Update result count with better feedback
        function updateResultCount(count) {
            const countElements = document.querySelectorAll('#resultCount, [id="resultCount"]');
            const searchTerm = document.getElementById('searchInput').value;
            
            let message = `${count} results`;
            
            if (searchTerm) {
                message += ` for "${searchTerm}"`;
            }
            
            // Add visual feedback based on result count
            countElements.forEach(element => {
                element.textContent = message;
                
                // Add color coding based on results
                element.className = element.className.replace(/text-\w+/g, ''); // Remove existing color classes
                if (count === 0) {
                    element.classList.add('text-danger');
                    element.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
                } else if (count < 10) {
                    element.classList.add('text-warning');
                    element.innerHTML = `<i class="fas fa-search"></i> ${message}`;
                } else {
                    element.classList.add('text-success');
                    element.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
                }
            });
            
            // Show/hide "no results" message
            if (count === 0) {
                showNoResultsMessage(searchTerm);
            } else {
                hideNoResultsMessage();
            }
        }
        
        // Show no results message
        function showNoResultsMessage(searchTerm) {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="11" class="text-center py-5">
                        <div class="text-muted">
                            <i class="fas fa-search fa-3x mb-3"></i>
                            <h5>No results found</h5>
                            <p>No colleges or programs match your search criteria</p>
                            ${searchTerm ? `<p><strong>Search term:</strong> "${searchTerm}"</p>` : ''}
                            <button class="btn btn-outline-primary" onclick="clearAllFilters()">
                                <i class="fas fa-refresh"></i> Clear All Filters
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }
        
        // Hide no results message (table will be populated with actual data)
        function hideNoResultsMessage() {
            // This is handled by populateDataTable function
        }
        
        // Toggle pagination function
        function togglePagination() {
            const toggle = document.getElementById('paginationToggle');
            const label = document.getElementById('toggleLabel');
            isPaginationEnabled = toggle.checked;
            
            if (isPaginationEnabled) {
                label.textContent = 'Show 70 rows';
                currentPage = 1;
                window.currentPage = 1;
                itemsPerPage = 70;
            } else {
                label.textContent = 'Show all rows';
                itemsPerPage = Infinity;
            }
            
            // Re-render the table with current data
            const dataToShow = isSearchActive ? filteredData : admissionData;
            populateDataTable(dataToShow, currentPage, itemsPerPage);
            
            // Show notification
            const message = isPaginationEnabled ? 
                ` Now showing 70 rows per page` : 
                ` Now showing all ${dataToShow.length} rows`;
            showToast(message, 'info');
        }
        
        // Sorting state for main table
        let mainTableSortState = {
            column: null,
            direction: 'asc' // 'asc' or 'desc'
        };
        
        // Sort main table by column
        function sortMainTable(column) {
            // Determine sort direction
            if (mainTableSortState.column === column) {
                mainTableSortState.direction = mainTableSortState.direction === 'asc' ? 'desc' : 'asc';
            } else {
                mainTableSortState.column = column;
                mainTableSortState.direction = 'asc';
            }
            
            // Get current data (filtered or full)
            const dataToSort = isSearchActive ? [...filteredData] : [...admissionData];
            
            // Sort the data
            dataToSort.sort((a, b) => {
                let valueA, valueB;
                
                switch(column) {
                    case 'sno':
                        valueA = parseInt(a['S.NO.']) || 0;
                        valueB = parseInt(b['S.NO.']) || 0;
                        break;
                    case 'college':
                        valueA = (a['NAME OF THE COLLEGE'] || '').toLowerCase();
                        valueB = (b['NAME OF THE COLLEGE'] || '').toLowerCase();
                        break;
                    case 'program':
                        valueA = (a['NAME OF THE PROGRAM'] || '').toLowerCase();
                        valueB = (b['NAME OF THE PROGRAM'] || '').toLowerCase();
                        break;
                    case 'ur':
                        valueA = parseInt(a.UR) || 0;
                        valueB = parseInt(b.UR) || 0;
                        break;
                    case 'obc':
                        valueA = parseInt(a.OBC) || 0;
                        valueB = parseInt(b.OBC) || 0;
                        break;
                    case 'sc':
                        valueA = parseInt(a.SC) || 0;
                        valueB = parseInt(b.SC) || 0;
                        break;
                    case 'st':
                        valueA = parseInt(a.ST) || 0;
                        valueB = parseInt(b.ST) || 0;
                        break;
                    case 'ews':
                        valueA = parseInt(a.EWS) || 0;
                        valueB = parseInt(b.EWS) || 0;
                        break;
                    case 'sikh':
                        valueA = parseInt(a.SIKH) || 0;
                        valueB = parseInt(b.SIKH) || 0;
                        break;
                    case 'pwbd':
                        valueA = parseInt(a.PwBD) || 0;
                        valueB = parseInt(b.PwBD) || 0;
                        break;
                    case 'total':
                        valueA = (parseInt(a.UR) || 0) + (parseInt(a.OBC) || 0) + (parseInt(a.SC) || 0) + 
                                 (parseInt(a.ST) || 0) + (parseInt(a.EWS) || 0) + (parseInt(a.SIKH) || 0) + (parseInt(a.PwBD) || 0);
                        valueB = (parseInt(b.UR) || 0) + (parseInt(b.OBC) || 0) + (parseInt(b.SC) || 0) + 
                                 (parseInt(b.ST) || 0) + (parseInt(b.EWS) || 0) + (parseInt(b.SIKH) || 0) + (parseInt(b.PwBD) || 0);
                        break;
                    default:
                        return 0;
                }
                
                // Compare values
                if (typeof valueA === 'string') {
                    return mainTableSortState.direction === 'asc' ? 
                        valueA.localeCompare(valueB) : valueB.localeCompare(valueA);
                } else {
                    return mainTableSortState.direction === 'asc' ? 
                        valueA - valueB : valueB - valueA;
                }
            });
            
            // Update the data reference
            if (isSearchActive) {
                filteredData = dataToSort;
            } else {
                // Don't modify original data, just use sorted version for display
            }
            
            // Update table with sorted data
            currentPage = 1;
            window.currentPage = 1;
            populateDataTable(dataToSort, currentPage, itemsPerPage);
            
            // Update sort indicators in headers
            updateSortIndicators(column, mainTableSortState.direction);
            
            // Show notification
            const directionText = mainTableSortState.direction === 'asc' ? 'ascending' : 'descending';
            showToast(` Table sorted by ${column.toUpperCase()} (${directionText})`, 'info');
        }
        
        // Update sort indicators in table headers
        function updateSortIndicators(activeColumn, direction) {
            // Reset all headers
            document.querySelectorAll('.sortable-header').forEach(header => {
                header.classList.remove('sorted-asc', 'sorted-desc');
                const icon = header.querySelector('i');
                if (icon) {
                    icon.className = 'fas fa-sort ms-1';
                }
            });
            
            // Set active header
            const activeHeader = document.querySelector(`[onclick="sortMainTable('${activeColumn}')"]`);
            if (activeHeader) {
                activeHeader.classList.add(direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
                const icon = activeHeader.querySelector('i');
                if (icon) {
                    icon.className = `fas fa-sort-${direction === 'asc' ? 'up' : 'down'} ms-1`;
                }
            }
        }
        
        // Sorting state for analysis tables
        let analysisSortStates = {
            college: { column: null, direction: 'asc' },
            program: { column: null, direction: 'asc' },
            category: { column: null, direction: 'asc' }
        };
        
        // Sort analysis tables (college, program, category)
        function sortAnalysisTable(tableType, column) {
            const state = analysisSortStates[tableType];
            
            // Determine sort direction
            if (state.column === column) {
                state.direction = state.direction === 'asc' ? 'desc' : 'asc';
            } else {
                state.column = column;
                state.direction = 'asc';
            }
            
            // Get table body and rows
            const tableId = `${tableType}AnalysisTable`;
            const tableBody = document.getElementById(tableId);
            if (!tableBody) return;
            
            const rows = Array.from(tableBody.querySelectorAll('tr'));
            if (rows.length === 0) return;
            
            // Sort rows
            rows.sort((rowA, rowB) => {
                let valueA, valueB;
                
                // Get cell index based on column
                let cellIndex;
                switch(column) {
                    case 'college':
                    case 'program':
                        cellIndex = 0;
                        break;
                    case 'totalSeats':
                        cellIndex = 1;
                        break;
                    case 'ur':
                        cellIndex = 2;
                        break;
                    case 'obc':
                        cellIndex = 3;
                        break;
                    case 'sc':
                        cellIndex = 4;
                        break;
                    case 'st':
                        cellIndex = 5;
                        break;
                    case 'ews':
                        cellIndex = 6;
                        break;
                    case 'sikh':
                        cellIndex = 7;
                        break;
                    case 'pwbd':
                        cellIndex = 8;
                        break;
                    case 'programs':
                    case 'colleges':
                        cellIndex = 9;
                        break;
                    default:
                        return 0;
                }
                
                // Extract values from cells
                const cellA = rowA.cells[cellIndex];
                const cellB = rowB.cells[cellIndex];
                
                if (!cellA || !cellB) return 0;
                
                if (column === 'college' || column === 'program') {
                    // Text sorting
                    valueA = cellA.textContent.trim().toLowerCase();
                    valueB = cellB.textContent.trim().toLowerCase();
                    return state.direction === 'asc' ? 
                        valueA.localeCompare(valueB) : valueB.localeCompare(valueA);
                } else {
                    // Numeric sorting (extract numbers from badges)
                    const badgeA = cellA.querySelector('.badge');
                    const badgeB = cellB.querySelector('.badge');
                    
                    valueA = badgeA ? parseFloat(badgeA.textContent.replace(/,/g, '')) || 0 : 0;
                    valueB = badgeB ? parseFloat(badgeB.textContent.replace(/,/g, '')) || 0 : 0;
                    
                    return state.direction === 'asc' ? valueA - valueB : valueB - valueA;
                }
            });
            
            // Clear table body and append sorted rows
            tableBody.innerHTML = '';
            rows.forEach(row => tableBody.appendChild(row));
            
            // Update sort indicators
            updateAnalysisSortIndicators(tableType, column, state.direction);
            
            // Show notification
            const directionText = state.direction === 'asc' ? 'ascending' : 'descending';
            const tableTypeCap = tableType.charAt(0).toUpperCase() + tableType.slice(1);
            showToast(` ${tableTypeCap} table sorted by ${column} (${directionText})`, 'info');
        }
        
        // Update sort indicators for analysis tables
        function updateAnalysisSortIndicators(tableType, activeColumn, direction) {
            const tableId = `${tableType}AnalysisTable`;
            const table = document.getElementById(tableId);
            if (!table) return;
            
            // Reset all headers in this table
            table.querySelectorAll('.sortable-header').forEach(header => {
                header.classList.remove('sorted-asc', 'sorted-desc');
                const icon = header.querySelector('i');
                if (icon) {
                    icon.className = 'fas fa-sort ms-1';
                }
            });
            
            // Set active header
            const activeHeader = table.querySelector(`[onclick="sortAnalysisTable('${tableType}', '${activeColumn}')"]`);
            if (activeHeader) {
                activeHeader.classList.add(direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
                const icon = activeHeader.querySelector('i');
                if (icon) {
                    icon.className = `fas fa-sort-${direction === 'asc' ? 'up' : 'down'} ms-1`;
                }
            }
        }
        
        // Show search results indicator
        function showSearchResultsIndicator(query, resultCount) {
            const indicator = document.getElementById('searchResultsIndicator');
            const text = document.getElementById('searchResultsText');
            
            if (resultCount > 0) {
                text.innerHTML = `
                    <i class="fas fa-check-circle text-success me-1"></i>
                    Found <strong>${resultCount}</strong> results${query ? ` for "${query}"` : ''}
                `;
                indicator.className = 'alert alert-success search-results-indicator mb-3';
            } else {
                text.innerHTML = `
                    <i class="fas fa-exclamation-triangle text-warning me-1"></i>
                    No results found${query ? ` for "${query}"` : ''}
                `;
                indicator.className = 'alert alert-warning search-results-indicator mb-3';
            }
            
            indicator.style.display = 'block';
        }
        
        // Hide search results indicator
        function hideSearchResultsIndicator() {
            const indicator = document.getElementById('searchResultsIndicator');
            indicator.style.display = 'none';
        }
        
        // Scroll to table with highlighting
        function scrollToTable() {
            const tableContainer = document.getElementById('mainDataTable');
            if (tableContainer) {
                // Add highlighting class
                tableContainer.classList.add('search-results-highlighted');
                
                // Scroll to table
                tableContainer.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start',
                    inline: 'nearest'
                });
                
                // Remove highlighting after animation
                setTimeout(() => {
                    tableContainer.classList.remove('search-results-highlighted');
                }, 3000);
            }
        }
        
        // Clear search and scroll back to top
        function clearSearchAndScroll() {
            // Clear all filters
            document.getElementById('searchInput').value = '';
            document.getElementById('categoryFilter').value = '';
            document.getElementById('collegeFilter').value = '';
            document.getElementById('programFilter').value = '';
            document.getElementById('sortBy').value = '';
            
            // Reset filter buttons
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            const allButton = document.querySelector('.filter-btn[onclick*="all"]');
            if (allButton) allButton.classList.add('active');
            
            // Hide search suggestions and indicator
            hideSearchSuggestions();
            hideSearchResultsIndicator();
            
            // Reset state
            isSearchActive = false;
            filteredData = [];
            currentPage = 1;
            
            // Show all data
            populateDataTable(admissionData, currentPage, isPaginationEnabled ? itemsPerPage : Infinity);
            updateResultCount(admissionData.length);
            
            // Scroll to top of page
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            showToast(' Filters cleared - showing all data', 'info');
        }
        
        // Main table search functionality
        function filterMainTable() {
            const searchTerm = document.getElementById('mainTableSearch').value.toLowerCase();
            
            if (!searchTerm) {
                // If search is empty, show normal data with current pagination settings
                isSearchActive = false;
                currentPage = 1;
                window.currentPage = 1;
                populateDataTable(admissionData, currentPage, isPaginationEnabled ? itemsPerPage : Infinity);
                updateResultCount(admissionData.length);
                return;
            }
            
            // Filter data based on search term
            const filtered = admissionData.filter(row => {
                return (
                    (row['NAME OF THE COLLEGE'] || '').toLowerCase().includes(searchTerm) ||
                    (row['NAME OF THE PROGRAM'] || '').toLowerCase().includes(searchTerm) ||
                    (row.UR || '').toString().includes(searchTerm) ||
                    (row.OBC || '').toString().includes(searchTerm) ||
                    (row.SC || '').toString().includes(searchTerm) ||
                    (row.ST || '').toString().includes(searchTerm) ||
                    (row.EWS || '').toString().includes(searchTerm) ||
                    (row.SIKH || '').toString().includes(searchTerm) ||
                    (row.PwBD || '').toString().includes(searchTerm)
                );
            });
            
            // Update state
            isSearchActive = true;
            filteredData = filtered;
            currentPage = 1;
            window.currentPage = 1;
            
            // Show filtered results (always show all search results, ignoring pagination)
            populateDataTable(filtered, 1, Infinity);
            updateResultCount(filtered.length);
            
            // Show search indicator if results found
            if (filtered.length > 0) {
                showSearchResultsIndicator(`Found ${filtered.length} results for "${searchTerm}"`);
            } else {
                showSearchResultsIndicator(`No results found for "${searchTerm}"`);
            }
        }
        
        // Clear main table search
        function clearMainTableSearch() {
            document.getElementById('mainTableSearch').value = '';
            hideSearchResultsIndicator();
            filterMainTable(); // This will reset to show all data
            showToast(' Search cleared', 'info');
        }
        
        // Show all data (disable pagination and show everything)
        function showAllData() {
            // Disable pagination
            isPaginationEnabled = false;
            document.getElementById('paginationToggle').checked = false;
            document.getElementById('toggleLabel').textContent = 'Show all rows';
            
            // Clear any search
            document.getElementById('mainTableSearch').value = '';
            hideSearchResultsIndicator();
            
            // Reset state
            isSearchActive = false;
            filteredData = [];
            currentPage = 1;
            window.currentPage = 1;
            
            // Show all data without pagination
            populateDataTable(admissionData, 1, Infinity);
            updateResultCount(admissionData.length);
            
            showToast(` Showing all ${admissionData.length} entries`, 'success');
        }
        
        // Store original analysis data for filtering
        let originalCollegeData = [];
        let originalProgramData = [];
        let originalCategoryData = [];
        
        // Filter college analysis table
        function filterCollegeAnalysis() {
            const searchTerm = document.getElementById('collegeSearchInput').value.toLowerCase();
            const tableBody = document.getElementById('collegeAnalysisTable');
            
            if (!originalCollegeData.length) {
                // Store original data if not already stored
                const rows = tableBody.querySelectorAll('tr');
                originalCollegeData = Array.from(rows).map(row => ({
                    element: row.cloneNode(true),
                    text: row.textContent.toLowerCase()
                }));
            }
            
            // Clear current table
            tableBody.innerHTML = '';
            
            // Filter and display matching rows
            const filteredData = originalCollegeData.filter(item => 
                item.text.includes(searchTerm)
            );
            
            filteredData.forEach(item => {
                tableBody.appendChild(item.element.cloneNode(true));
            });
            
            // Show no results message if needed
            if (filteredData.length === 0 && searchTerm) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="10" class="text-center text-muted">
                    <i class="fas fa-search me-2"></i>No colleges found for "${searchTerm}"
                </td>`;
                tableBody.appendChild(row);
            }
        }
        
        // Filter program analysis table
        function filterProgramAnalysis() {
            const searchTerm = document.getElementById('programSearchInput').value.toLowerCase();
            const tableBody = document.getElementById('programAnalysisTable');
            
            if (!originalProgramData.length) {
                // Store original data if not already stored
                const rows = tableBody.querySelectorAll('tr');
                originalProgramData = Array.from(rows).map(row => ({
                    element: row.cloneNode(true),
                    text: row.textContent.toLowerCase()
                }));
            }
            
            // Clear current table
            tableBody.innerHTML = '';
            
            // Filter and display matching rows
            const filteredData = originalProgramData.filter(item => 
                item.text.includes(searchTerm)
            );
            
            filteredData.forEach(item => {
                tableBody.appendChild(item.element.cloneNode(true));
            });
            
            // Show no results message if needed
            if (filteredData.length === 0 && searchTerm) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="10" class="text-center text-muted">
                    <i class="fas fa-search me-2"></i>No programs found for "${searchTerm}"
                </td>`;
                tableBody.appendChild(row);
            }
        }

        // Filter by program type
        function filterByType(type) {
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            let filteredData = admissionData;

            if (type !== 'all') {
                filteredData = filteredData.filter(row => {
                    const program = (row[2] || '').toLowerCase();
                    
                    switch(type) {
                        case 'bcom': return program.includes('b.com');
                        case 'bsc': return program.includes('b.sc');
                        case 'ba': return program.includes('b.a');
                        case 'honours': return program.includes('hons');
                        case 'program': return program.includes('program');
                        case 'beled': return program.includes('b.el.ed');
                        case 'bms': return program.includes('bms');
                        case 'bba': return program.includes('bba');
                        default: return true;
                    }
                });
            }

            populateDataTable(filteredData);
            updateResultCount(filteredData.length);
        }

        // Get category column index
        function getCategoryIndex(category) {
            const categoryMap = {
                'UR': 3, 'OBC': 4, 'SC': 5, 'ST': 6, 
                'EWS': 7, 'SIKH': 8, 'PwBD': 9
            };
            return categoryMap[category] || 0;
        }

        // Global variable to store current filtered data
        let currentFilteredData = [];
        
        // Populate data table with pagination
        function populateDataTable(data, page = 1, maxItemsPerPage = 70) {
            const tbody = document.getElementById('dataTableBody');
            tbody.innerHTML = '';
            
            // Store current data for pagination
            currentFilteredData = data;

            // Pagination settings
            const actualItemsPerPage = maxItemsPerPage === Infinity ? data.length : maxItemsPerPage;
            const startIndex = (page - 1) * actualItemsPerPage;
            const endIndex = maxItemsPerPage === Infinity ? data.length : startIndex + actualItemsPerPage;
            const displayData = data.slice(startIndex, endIndex);

            // Calculate column totals for all data (not just displayed)
            let columnTotals = {
                ur: 0, obc: 0, sc: 0, st: 0, ews: 0, sikh: 0, pwbd: 0, total: 0
            };

            data.forEach(row => {
                const ur = parseInt(row.UR) || 0;
                const obc = parseInt(row.OBC) || 0;
                const sc = parseInt(row.SC) || 0;
                const st = parseInt(row.ST) || 0;
                const ews = parseInt(row.EWS) || 0;
                const sikh = parseInt(row.SIKH) || 0;
                const pwbd = parseInt(row.PwBD) || 0;

                columnTotals.ur += ur;
                columnTotals.obc += obc;
                columnTotals.sc += sc;
                columnTotals.st += st;
                columnTotals.ews += ews;
                columnTotals.sikh += sikh;
                columnTotals.pwbd += pwbd;
                columnTotals.total += (ur + obc + sc + st + ews + sikh + pwbd);
            });

            // Populate table with current page data
            displayData.forEach((row, index) => {
                const tr = document.createElement('tr');
                const actualIndex = startIndex + index + 1;

                // Calculate total seats
                const ur = parseInt(row.UR) || 0;
                const obc = parseInt(row.OBC) || 0;
                const sc = parseInt(row.SC) || 0;
                const st = parseInt(row.ST) || 0;
                const ews = parseInt(row.EWS) || 0;
                const sikh = parseInt(row.SIKH) || 0;
                const pwbd = parseInt(row.PwBD) || 0;
                const total = ur + obc + sc + st + ews + sikh + pwbd;

                tr.innerHTML = `
                    <td>${row['S.NO.'] || actualIndex}</td>
                    <td class="college-name">
                        <strong>${row['NAME OF THE COLLEGE'] || 'Unknown College'}</strong>
                    </td>
                    <td class="program-name">
                        ${row['NAME OF THE PROGRAM'] || 'Unknown Program'}
                    </td>
                    <td><span class="badge ${ur > 0 ? 'bg-primary' : 'bg-light text-dark'}">${ur}</span></td>
                    <td><span class="badge ${obc > 0 ? 'bg-success' : 'bg-light text-dark'}">${obc}</span></td>
                    <td><span class="badge ${sc > 0 ? 'bg-info' : 'bg-light text-dark'}">${sc}</span></td>
                    <td><span class="badge ${st > 0 ? 'bg-warning' : 'bg-light text-dark'}">${st}</span></td>
                    <td><span class="badge ${ews > 0 ? 'bg-secondary' : 'bg-light text-dark'}">${ews}</span></td>
                    <td><span class="badge ${sikh > 0 ? 'bg-dark' : 'bg-light text-dark'}">${sikh}</span></td>
                    <td><span class="badge ${pwbd > 0 ? 'bg-danger' : 'bg-light text-dark'}">${pwbd}</span></td>
                    <td><strong><span class="badge ${total > 0 ? 'bg-primary' : 'bg-light text-dark'}">${total}</span></strong></td>
                `;

                tbody.appendChild(tr);
            });

            // Add column totals row
            const totalsRow = document.createElement('tr');
            totalsRow.className = 'table-totals-row fw-bold';
            totalsRow.innerHTML = `
                <td colspan="3" class="text-center">
                    <strong> COLUMN TOTALS</strong>
                    <br><small class="text-muted">(All ${data.length} records)</small>
                </td>
                <td><strong><span class="badge bg-primary fs-6">${columnTotals.ur.toLocaleString()}</span></strong></td>
                <td><strong><span class="badge bg-success fs-6">${columnTotals.obc.toLocaleString()}</span></strong></td>
                <td><strong><span class="badge bg-info fs-6">${columnTotals.sc.toLocaleString()}</span></strong></td>
                <td><strong><span class="badge bg-warning fs-6">${columnTotals.st.toLocaleString()}</span></strong></td>
                <td><strong><span class="badge bg-secondary fs-6">${columnTotals.ews.toLocaleString()}</span></strong></td>
                <td><strong><span class="badge bg-dark fs-6">${columnTotals.sikh.toLocaleString()}</span></strong></td>
                <td><strong><span class="badge bg-danger fs-6">${columnTotals.pwbd.toLocaleString()}</span></strong></td>
                <td><strong><span class="badge bg-primary fs-5">${columnTotals.total.toLocaleString()}</span></strong></td>
            `;
            tbody.appendChild(totalsRow);

            // Add pagination controls only if pagination is enabled
            if (isPaginationEnabled && maxItemsPerPage !== Infinity) {
                createPaginationControls(data, page, actualItemsPerPage);
            } else {
                // Clear pagination controls when showing all data
                const paginationContainer = document.getElementById('paginationContainer');
                if (paginationContainer) {
                    paginationContainer.innerHTML = '';
                }
            }
        }
        
        // Helper function to truncate text
        function truncateText(text, maxLength) {
            if (!text) return 'N/A';
            return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
        }

        // Export to Excel
        function exportToExcel() {
            console.log(' Downloading Excel file...');
            window.open('/api/download/excel', '_blank');
        }

        // Show/hide loading spinner
        function showLoading(show) {
            document.getElementById('loadingSpinner').style.display = show ? 'block' : 'none';
        }

        // Show/hide dashboard content
        function showDashboard() {
            document.getElementById('dashboardContent').style.display = 'block';
        }

        // Show error message
        function showError(message) {
            document.getElementById('errorText').textContent = message;
            document.getElementById('errorMessage').style.display = 'block';
        }

        // Console welcome message
        console.log(`
         DU Admission Analyzer Dashboard
        ================================
         Interactive Charts & Analytics
         Advanced Search & Filtering  
         Mobile Responsive Design
         Perfect Data Processing (100% Efficiency)
        
        API Status: Ready
        Data Processing: PERFECT Clean (1528 rows, 0% loss)
        Charts: Interactive
        Backend: Optimized with Perfect Cleaner
        `);

        // Lightweight table interactions - Performance Optimized
        function initTableHoverEffects() {
            const table = document.querySelector('#admissionTable');
            if (!table) return;

            // Simple row click functionality
            table.addEventListener('click', function(e) {
                const row = e.target.closest('tr');
                if (!row || row.classList.contains('table-totals-row')) return;

                // Remove previous selection
                const selected = table.querySelector('tr.selected');
                if (selected) {
                    selected.classList.remove('selected');
                }

                // Add selection to clicked row
                row.classList.add('selected');

                // Simple feedback
                const collegeCell = row.querySelector('.college-name');
                const programCell = row.querySelector('.program-name');
                
                if (collegeCell && programCell) {
                    showToast(`Selected: ${collegeCell.textContent.trim()}`, 'info');
                }
            });

            // Simple badge click functionality
            table.addEventListener('click', function(e) {
                if (e.target.classList.contains('badge') && !e.target.closest('.table-totals-row')) {
                    const badge = e.target;
                    const row = badge.closest('tr');
                    const cell = badge.closest('td');
                    const columnIndex = Array.from(row.children).indexOf(cell);
                    const headers = ['S.No', 'College', 'Program', 'UR', 'OBC', 'SC', 'ST', 'EWS', 'SIKH', 'PwBD', 'Total'];
                    const category = headers[columnIndex];
                    const value = badge.textContent.trim();

                    if (category && !isNaN(value)) {
                        showToast(`${category}: ${value} seats`, 'info');
                    }
                    e.stopPropagation();
                }
            });

            console.log(' Lightweight table interactions initialized');
        }

        // Simple tooltips using browser defaults
        function initAdvancedTooltips() {
            // Use native browser tooltips for better performance
            const categoryInfo = {
                'UR': 'Unreserved (General Category)',
                'OBC': 'Other Backward Classes',
                'SC': 'Scheduled Castes',
                'ST': 'Scheduled Tribes',
                'EWS': 'Economically Weaker Sections',
                'SIKH': 'Sikh Minority',
                'PwBD': 'Persons with Benchmark Disabilities'
            };

            // Simple one-time setup for badge tooltips
            setTimeout(() => {
                const badges = document.querySelectorAll('.table .badge');
                badges.forEach(badge => {
                    const row = badge.closest('tr');
                    if (row && !row.classList.contains('table-totals-row')) {
                        const cell = badge.closest('td');
                        const columnIndex = Array.from(row.children).indexOf(cell);
                        const headers = ['S.No', 'College', 'Program', 'UR', 'OBC', 'SC', 'ST', 'EWS', 'SIKH', 'PwBD', 'Total'];
                        const category = headers[columnIndex];

                        if (categoryInfo[category]) {
                            badge.title = `${categoryInfo[category]}: ${badge.textContent.trim()} seats`;
                        }
                    }
                });
            }, 500);

            console.log(' Simple tooltips initialized');
        }

        // Initialize lightweight interactions when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                initTableHoverEffects();
                initAdvancedTooltips();
            }, 500);
        });

        // Vacancy Analysis Functions
        let vacancyCharts = {};

        async function loadVacancyAnalysis() {
            try {
                console.log(' Loading advanced vacancy analysis...');
                const response = await fetch('/api/vacancy-analysis');
                
                if (response.ok) {
                    const analysis = await response.json();
                    console.log(' Vacancy analysis loaded:', analysis);
                    displayVacancyAnalysis(analysis);
                } else {
                    console.error(' Failed to load vacancy analysis');
                }
            } catch (error) {
                console.error(' Error loading vacancy analysis:', error);
            }
        }

        function displayVacancyAnalysis(analysis) {
            const data = analysis;
            
            // Update core metrics
            document.getElementById('totalVacancies').textContent = data.core_statistics.total_vacancies.toLocaleString();
            
            // Find top category
            const topCategory = Object.keys(data.core_statistics.category_totals).reduce((a, b) => 
                data.core_statistics.category_totals[a] > data.core_statistics.category_totals[b] ? a : b
            );
            document.getElementById('topCategory').textContent = topCategory;
            
            document.getElementById('concentrationIndex').textContent = 
                (data.advanced_indices.vacancy_concentration_index * 100).toFixed(1) + '%';
            
            document.getElementById('zeroVacancyCount').textContent = 
                data.core_statistics.zero_vacancies.programs.length;

            // Display insights
            const insightsList = document.getElementById('insightsList');
            insightsList.innerHTML = '';
            data.insights.forEach(insight => {
                const div = document.createElement('div');
                div.className = 'insight-item';
                div.innerHTML = `
                    <div class="d-flex align-items-start">
                        <span class="me-2" style="font-size: 1.2em;">${insight.icon}</span>
                        <div>
                            <strong>${insight.title}</strong>
                            <p class="mb-0 mt-1 text-muted">${insight.description}</p>
                        </div>
                    </div>
                `;
                insightsList.appendChild(div);
            });

            // Display recommendations
            const recommendationsList = document.getElementById('recommendationsList');
            recommendationsList.innerHTML = '';
            data.recommendations.forEach(rec => {
                const div = document.createElement('div');
                div.className = 'recommendation-item';
                div.innerHTML = `
                    <div>
                        <strong>${rec.title}</strong>
                        <p class="mb-0 mt-1 text-muted">${rec.description}</p>
                        <span class="badge bg-success mt-2">${rec.type.toUpperCase()}</span>
                    </div>
                `;
                recommendationsList.appendChild(div);
            });

            // Display metrics table
            const metricsBody = document.getElementById('metricsTableBody');
            metricsBody.innerHTML = '';
            
            const metrics = [
                {
                    name: 'Category Imbalance Index',
                    value: data.advanced_indices.category_imbalance_index,
                    description: 'Measures inequality in category-wise vacancy distribution'
                },
                {
                    name: 'Vacancy Concentration Index',
                    value: (data.advanced_indices.vacancy_concentration_index * 100).toFixed(1) + '%',
                    description: 'Percentage of vacancies concentrated in top 10 colleges'
                },
                {
                    name: 'Top College Ratio',
                    value: (data.advanced_indices.top_college_ratio * 100).toFixed(2) + '%',
                    description: 'Highest single college contribution to total vacancies'
                },
                {
                    name: 'Zero Vacancy Rate',
                    value: ((data.core_statistics.zero_vacancies.programs.length / data.total_records) * 100).toFixed(1) + '%',
                    description: 'Percentage of programs with no vacant seats'
                }
            ];

            metrics.forEach(metric => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${metric.name}</strong></td>
                    <td><span class="badge bg-primary">${metric.value}</span></td>
                    <td class="text-muted">${metric.description}</td>
                `;
                metricsBody.appendChild(row);
            });

            // Render charts
            renderVacancyCharts(data.visualizations);
        }

        function renderVacancyCharts(visualizations) {
            // Category Distribution Pie Chart
            renderVacancyCategoryChart(visualizations.category_pie_data);
            
            // College Treemap (as bar chart)
            renderCollegeTreemapChart(visualizations.treemap_data);
            
            // Program Stacked Chart
            renderProgramStackedChart(visualizations.stacked_bar_data);
        }

        function renderVacancyCategoryChart(data) {
            const ctx = document.getElementById('vacancyCategoryChart').getContext('2d');
            
            if (vacancyCharts.category) {
                vacancyCharts.category.destroy();
            }
            
            vacancyCharts.category = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: data.labels,
                    datasets: [{
                        data: data.data,
                        backgroundColor: [
                            '#3b82f6', '#10b981', '#f59e0b', '#ef4444',
                            '#8b5cf6', '#06b6d4', '#84cc16'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function renderCollegeTreemapChart(data) {
            const ctx = document.getElementById('collegeTreemapChart').getContext('2d');
            
            if (vacancyCharts.treemap) {
                vacancyCharts.treemap.destroy();
            }
            
            vacancyCharts.treemap = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(item => item.name.length > 15 ? item.name.substring(0, 15) + '...' : item.name),
                    datasets: [{
                        label: 'Total Seats',
                        data: data.map(item => item.value),
                        backgroundColor: '#3b82f6',
                        borderColor: '#1d4ed8',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function renderProgramStackedChart(data) {
            const ctx = document.getElementById('programStackedChart').getContext('2d');
            
            if (vacancyCharts.stacked) {
                vacancyCharts.stacked.destroy();
            }
            
            const datasets = data.categories.map((category, index) => ({
                label: category,
                data: data.data.map(programData => programData[index] || 0),
                backgroundColor: [
                    '#3b82f6', '#10b981', '#f59e0b', '#ef4444',
                    '#8b5cf6', '#06b6d4', '#84cc16'
                ][index],
                borderWidth: 1
            }));
            
            vacancyCharts.stacked = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.programs.map(p => p.length > 12 ? p.substring(0, 12) + '...' : p),
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Create pagination controls
        function createPaginationControls(data, currentPage, itemsPerPage) {
            const totalPages = Math.ceil(data.length / itemsPerPage);
            let paginationContainer = document.getElementById('paginationContainer');
            
            if (!paginationContainer) {
                paginationContainer = document.createElement('div');
                paginationContainer.id = 'paginationContainer';
                paginationContainer.className = 'pagination-container mt-3';
                
                const tableSection = document.querySelector('.table-responsive');
                if (tableSection && tableSection.parentNode) {
                    tableSection.parentNode.insertBefore(paginationContainer, tableSection.nextSibling);
                }
            }
            
            let paginationHTML = `
                <nav aria-label="Table pagination">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="pagination-info">
                            <span class="text-muted">
                                Showing ${(currentPage - 1) * itemsPerPage + 1} to ${Math.min(currentPage * itemsPerPage, data.length)} 
                                of ${data.length} entries
                            </span>
                        </div>
                        <ul class="pagination mb-0">
            `;

            // Previous button
            paginationHTML += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1}); return false;">
                        <i class="fas fa-chevron-left"></i> Previous
                    </a>
                </li>
            `;

            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${i}); return false;">${i}</a>
                    </li>
                `;
            }

            // Next button
            paginationHTML += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1}); return false;">
                        Next <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            `;

            paginationHTML += `
                        </ul>
                    </div>
                </nav>
            `;

            paginationContainer.innerHTML = paginationHTML;
        }

        // Change page function
        function changePage(newPage) {
            // Use the correct page size based on pagination state
            const itemsPerPage = isPaginationEnabled ? 70 : Infinity;
            const totalPages = Math.ceil(currentFilteredData.length / (itemsPerPage === Infinity ? currentFilteredData.length : itemsPerPage));
            
            if (newPage >= 1 && newPage <= totalPages) {
                // Update both global variables
                currentPage = newPage;
                window.currentPage = newPage;
                
                populateDataTable(currentFilteredData, newPage, itemsPerPage);
                
                // Scroll to table
                const tableSection = document.querySelector('.table-responsive');
                if (tableSection) {
                    tableSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                }
            }
        }

        // Advanced Analysis Functions
        async function loadCollegeAnalysis() {
            try {
                console.log(' Loading college analysis...');
                const response = await fetch('/api/analysis/by-college');
                
                if (response.ok) {
                    const analysis = await response.json();
                    console.log(' College analysis loaded:', analysis);
                    displayCollegeAnalysis(analysis);
                } else {
                    console.error(' Failed to load college analysis');
                }
            } catch (error) {
                console.error(' Error loading college analysis:', error);
            }
        }

        async function loadProgramAnalysis() {
            try {
                console.log(' Loading program analysis...');
                const response = await fetch('/api/analysis/by-program');
                
                if (response.ok) {
                    const analysis = await response.json();
                    console.log(' Program analysis loaded:', analysis);
                    displayProgramAnalysis(analysis);
                } else {
                    console.error(' Failed to load program analysis');
                }
            } catch (error) {
                console.error(' Error loading program analysis:', error);
            }
        }

        async function loadCategoryAnalysis() {
            try {
                console.log(' Loading category analysis...');
                const response = await fetch('/api/analysis/by-category');
                
                if (response.ok) {
                    const analysis = await response.json();
                    console.log(' Category analysis loaded:', analysis);
                    displayCategoryAnalysis(analysis);
                } else {
                    console.error(' Failed to load category analysis');
                }
            } catch (error) {
                console.error(' Error loading category analysis:', error);
            }
        }

        function displayCollegeAnalysis(analysis) {
            console.log(' Displaying college analysis:', analysis);
            
            // Safe access with fallbacks
            const totalColleges = analysis?.total_colleges || 0;
            const colleges = analysis?.colleges || [];
            
            // Calculate average seats
            let totalSeats = 0;
            if (Array.isArray(colleges) && colleges.length > 0) {
                totalSeats = colleges.reduce((sum, college) => sum + (college.total_seats || 0), 0);
            }
            const avgSeats = totalColleges > 0 ? Math.round(totalSeats / totalColleges) : 0;
            
            // Update metrics with safe values
            document.getElementById('collegeAnalysisTotal').textContent = totalColleges;
            document.getElementById('collegeAnalysisAvg').textContent = avgSeats;
            
            // Find top college safely
            let topSeats = 0;
            if (Array.isArray(colleges)) {
                colleges.forEach(college => {
                    const seats = college?.total_seats || 0;
                    if (seats > topSeats) {
                        topSeats = seats;
                    }
                });
            }
            document.getElementById('collegeAnalysisTop').textContent = topSeats;
            
            // Helper function to parse categories (handles both JSON object and PowerShell string formats)
            function parseCategories(categoriesData) {
                const defaults = { UR: 0, OBC: 0, SC: 0, ST: 0, EWS: 0, SIKH: 0, PwBD: 0 };
                
                if (!categoriesData) {
                    return defaults;
                }
                
                // If it's already an object (JSON response), use it directly
                if (typeof categoriesData === 'object' && categoriesData !== null) {
                    return {
                        UR: categoriesData.UR || 0,
                        OBC: categoriesData.OBC || 0,
                        SC: categoriesData.SC || 0,
                        ST: categoriesData.ST || 0,
                        EWS: categoriesData.EWS || 0,
                        SIKH: categoriesData.SIKH || 0,
                        PwBD: categoriesData.PwBD || 0
                    };
                }
                
                // If it's a PowerShell format string, parse it
                if (typeof categoriesData === 'string') {
                    // Remove @{ and } and split by semicolon
                    const cleanStr = categoriesData.replace(/^@\{|\}$/g, '');
                    const pairs = cleanStr.split(/;\s*/);
                    
                    pairs.forEach(pair => {
                        const [key, value] = pair.split('=');
                        if (key && value) {
                            defaults[key.trim()] = parseInt(value.trim()) || 0;
                        }
                    });
                }
                
                return defaults;
            }
            
            // Populate table
            const tableBody = document.getElementById('collegeAnalysisTable');
            tableBody.innerHTML = '';
            
            if (Array.isArray(colleges) && colleges.length > 0) {
                colleges.forEach(college => { // Show all colleges, not just top 20
                    const categories = parseCategories(college.categories);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${college.college_name || college.name || 'Unknown'}</strong></td>
                        <td><span class="badge bg-primary">${(college.total_seats || 0).toLocaleString()}</span></td>
                        <td><span class="badge bg-info">${categories.UR}</span></td>
                        <td><span class="badge bg-success">${categories.OBC}</span></td>
                        <td><span class="badge bg-warning">${categories.SC}</span></td>
                        <td><span class="badge bg-danger">${categories.ST}</span></td>
                        <td><span class="badge bg-secondary">${categories.EWS}</span></td>
                        <td><span class="badge bg-dark">${categories.SIKH}</span></td>
                        <td><span class="badge bg-light text-dark">${categories.PwBD}</span></td>
                        <td><span class="badge bg-primary">${college.program_count || 0}</span></td>
                    `;
                    tableBody.appendChild(row);
                });
                
                // Clear and reset original data for search functionality
                originalCollegeData = [];
                setTimeout(() => {
                    const rows = tableBody.querySelectorAll('tr');
                    originalCollegeData = Array.from(rows).map(row => ({
                        element: row.cloneNode(true),
                        text: row.textContent.toLowerCase()
                    }));
                }, 100);
                
            } else {
                // Show no data message
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="10" class="text-center text-muted">No college data available</td>';
                tableBody.appendChild(row);
            }
        }

        function displayProgramAnalysis(analysis) {
            console.log(' Displaying program analysis:', analysis);
            
            // Safe access with fallbacks
            const totalPrograms = analysis?.total_programs || 0;
            const programs = analysis?.programs || [];
            
            // Calculate average seats
            let totalSeats = 0;
            if (Array.isArray(programs) && programs.length > 0) {
                totalSeats = programs.reduce((sum, program) => sum + (program.total_seats || 0), 0);
            }
            const avgSeats = totalPrograms > 0 ? Math.round(totalSeats / totalPrograms) : 0;
            
            // Update metrics with safe values
            document.getElementById('programAnalysisTotal').textContent = totalPrograms;
            document.getElementById('programAnalysisAvg').textContent = avgSeats;
            
            // Find top program safely
            let topSeats = 0;
            if (Array.isArray(programs)) {
                programs.forEach(program => {
                    const seats = program?.total_seats || 0;
                    if (seats > topSeats) {
                        topSeats = seats;
                    }
                });
            }
            document.getElementById('programAnalysisTop').textContent = topSeats;
            
            // Helper function to parse categories (handles both JSON object and PowerShell string formats)
            function parseCategories(categoriesData) {
                const defaults = { UR: 0, OBC: 0, SC: 0, ST: 0, EWS: 0, SIKH: 0, PwBD: 0 };
                
                if (!categoriesData) {
                    return defaults;
                }
                
                // If it's already an object (JSON response), use it directly
                if (typeof categoriesData === 'object' && categoriesData !== null) {
                    return {
                        UR: categoriesData.UR || 0,
                        OBC: categoriesData.OBC || 0,
                        SC: categoriesData.SC || 0,
                        ST: categoriesData.ST || 0,
                        EWS: categoriesData.EWS || 0,
                        SIKH: categoriesData.SIKH || 0,
                        PwBD: categoriesData.PwBD || 0
                    };
                }
                
                // If it's a PowerShell format string, parse it
                if (typeof categoriesData === 'string') {
                    // Remove @{ and } and split by semicolon
                    const cleanStr = categoriesData.replace(/^@\{|\}$/g, '');
                    const pairs = cleanStr.split(/;\s*/);
                    
                    pairs.forEach(pair => {
                        const [key, value] = pair.split('=');
                        if (key && value) {
                            defaults[key.trim()] = parseInt(value.trim()) || 0;
                        }
                    });
                }
                
                return defaults;
                const pairs = cleanStr.split(/;\s*/);
                
                pairs.forEach(pair => {
                    const [key, value] = pair.split('=');
                    if (key && value) {
                        defaults[key.trim()] = parseInt(value.trim()) || 0;
                    }
                });
                
                return defaults;
            }
            
            // Store original data for filtering
            originalProgramData = programs;
            
            // Populate table with all programs
            const tableBody = document.getElementById('programAnalysisTable');
            tableBody.innerHTML = '';
            
            if (Array.isArray(programs) && programs.length > 0) {
                programs.forEach(program => { // Show all programs
                    const categories = parseCategories(program.categories);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${program.program_name || program.name || 'Unknown'}</strong></td>
                        <td><span class="badge bg-primary">${(program.total_seats || 0).toLocaleString()}</span></td>
                        <td><span class="badge bg-info">${categories.UR}</span></td>
                        <td><span class="badge bg-success">${categories.OBC}</span></td>
                        <td><span class="badge bg-warning">${categories.SC}</span></td>
                        <td><span class="badge bg-danger">${categories.ST}</span></td>
                        <td><span class="badge bg-secondary">${categories.EWS}</span></td>
                        <td><span class="badge bg-dark">${categories.SIKH}</span></td>
                        <td><span class="badge bg-light text-dark">${categories.PwBD}</span></td>
                        <td><span class="badge bg-primary">${program.college_count || 0}</span></td>
                    `;
                    tableBody.appendChild(row);
                });
            } else {
                // Show no data message
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="10" class="text-center text-muted">No program data available</td>';
                tableBody.appendChild(row);
            }
        }

        function displayCategoryAnalysis(analysis) {
            console.log(' Displaying category analysis:', analysis);
            
            // Safe access with fallbacks - API returns categories array directly
            const categories = analysis?.categories || [];
            
            // Update metrics safely
            let highest = { category: 'N/A', seats: 0 };
            let lowest = { category: 'N/A', seats: Infinity };
            let totalSeats = 0;
            
            if (Array.isArray(categories) && categories.length > 0) {
                categories.forEach(cat => {
                    const seats = cat?.total_seats || 0;
                    totalSeats += seats;
                    
                    if (seats > highest.seats) {
                        highest = { category: cat.category_name || 'Unknown', seats: seats };
                    }
                    if (seats < lowest.seats && seats > 0) {
                        lowest = { category: cat.category_name || 'Unknown', seats: seats };
                    }
                });
                
                if (lowest.seats === Infinity) {
                    lowest = { category: 'N/A', seats: 0 };
                }
            }
            
            document.getElementById('categoryAnalysisHighest').textContent = highest.category;
            document.getElementById('categoryAnalysisLowest').textContent = lowest.category;
            
            // Populate table
            const tableBody = document.getElementById('categoryAnalysisTable');
            tableBody.innerHTML = '';
            
            if (Array.isArray(categories) && categories.length > 0) {
                // Sort by total seats descending
                const sortedCategories = categories.sort((a, b) => (b.total_seats || 0) - (a.total_seats || 0));
                
                sortedCategories.forEach(category => {
                    const seats = category.total_seats || 0;
                    const percentage = totalSeats > 0 ? ((seats / totalSeats) * 100).toFixed(1) : '0.0';
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td><strong>${category.category_name || 'Unknown'}</strong></td>
                        <td><span class="badge bg-primary">${seats.toLocaleString()}</span></td>
                        <td><span class="badge bg-success">${percentage}%</span></td>
                        <td><span class="badge bg-info">${category.colleges_with_seats || 0}</span></td>
                        <td><span class="badge bg-warning">${category.programs_with_seats || 0}</span></td>
                        <td>${category.category_full_name || 'No description available'}</td>
                    `;
                    tableBody.appendChild(row);
                });
            } else {
                // Show no data message
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="6" class="text-center text-muted">No category data available</td>';
                tableBody.appendChild(row);
            }
        }
        
        // Enhanced Search Functions
        function toggleAdvancedSearch() {
            const panel = document.getElementById('advancedSearchPanel');
            if (panel) {
                panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
            }
        }

        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (searchTerm.length < 2) {
                showToast('Please enter at least 2 characters to search', 'warning');
                return;
            }

            // Show search results section
            document.getElementById('searchResultsSection').style.display = 'block';
            
            // Filter data based on search term
            const filteredData = admissionData.filter(row => {
                return row['NAME OF THE COLLEGE'].toLowerCase().includes(searchTerm) ||
                       row['NAME OF THE PROGRAM'].toLowerCase().includes(searchTerm) ||
                       searchTerm.split(' ').some(word => 
                           row['NAME OF THE COLLEGE'].toLowerCase().includes(word) ||
                           row['NAME OF THE PROGRAM'].toLowerCase().includes(word)
                       );
            });

            // Update results count
            document.getElementById('searchResultsCount').textContent = filteredData.length + ' results found';
            
            // Populate search results table with pagination
            populateSearchResultsTable(filteredData);
            
            // Show toast notification
            showToast('Search completed! Found ' + filteredData.length + ' results', 'success');
            
            // Scroll to results
            document.getElementById('searchResultsSection').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        function populateSearchResultsTable(data) {
            const tbody = document.getElementById('searchResultsTable');
            tbody.innerHTML = '';
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="11" class="text-center text-muted py-4"><i class="fas fa-search"></i> No results found. Try different keywords.</td></tr>';
                return;
            }

            // Pagination for search results
            const itemsPerPage = 50;
            const currentPage = window.searchCurrentPage || 1;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const displayData = data.slice(startIndex, endIndex);

            displayData.forEach((row, index) => {
                const tr = document.createElement('tr');
                const actualIndex = startIndex + index + 1;

                // Calculate totals
                const ur = parseInt(row.UR) || 0;
                const obc = parseInt(row.OBC) || 0;
                const sc = parseInt(row.SC) || 0;
                const st = parseInt(row.ST) || 0;
                const ews = parseInt(row.EWS) || 0;
                const sikh = parseInt(row.SIKH) || 0;
                const pwbd = parseInt(row.PwBD) || 0;
                const total = ur + obc + sc + st + ews + sikh + pwbd;

                tr.innerHTML = 
                    '<td>' + actualIndex + '</td>' +
                    '<td><strong>' + truncateText(row['NAME OF THE COLLEGE'], 25) + '</strong></td>' +
                    '<td>' + truncateText(row['NAME OF THE PROGRAM'], 30) + '</td>' +
                    '<td><span class="badge ' + (ur > 0 ? 'bg-primary' : 'bg-light text-dark') + '">' + ur + '</span></td>' +
                    '<td><span class="badge ' + (obc > 0 ? 'bg-success' : 'bg-light text-dark') + '">' + obc + '</span></td>' +
                    '<td><span class="badge ' + (sc > 0 ? 'bg-info' : 'bg-light text-dark') + '">' + sc + '</span></td>' +
                    '<td><span class="badge ' + (st > 0 ? 'bg-warning' : 'bg-light text-dark') + '">' + st + '</span></td>' +
                    '<td><span class="badge ' + (ews > 0 ? 'bg-secondary' : 'bg-light text-dark') + '">' + ews + '</span></td>' +
                    '<td><span class="badge ' + (sikh > 0 ? 'bg-dark' : 'bg-light text-dark') + '">' + sikh + '</span></td>' +
                    '<td><span class="badge ' + (pwbd > 0 ? 'bg-danger' : 'bg-light text-dark') + '">' + pwbd + '</span></td>' +
                    '<td><strong><span class="badge ' + (total > 0 ? 'bg-primary' : 'bg-light text-dark') + '">' + total + '</span></strong></td>';

                tbody.appendChild(tr);
            });

            // Create search pagination
            createSearchPagination(data, currentPage, itemsPerPage);
        }

        function createSearchPagination(data, currentPage, itemsPerPage) {
            const totalPages = Math.ceil(data.length / itemsPerPage);
            const container = document.getElementById('searchPaginationContainer');
            
            if (totalPages <= 1) {
                container.innerHTML = '';
                return;
            }
            
            let paginationHTML = '<nav><ul class="pagination justify-content-center mb-0">';

            // Previous button
            paginationHTML += '<li class="page-item ' + (currentPage === 1 ? 'disabled' : '') + '">';
            paginationHTML += '<a class="page-link" href="#" onclick="changeSearchPage(' + (currentPage - 1) + '); return false;">Previous</a>';
            paginationHTML += '</li>';

            // Page numbers (show 5 pages max)
            const maxPages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPages / 2));
            let endPage = Math.min(totalPages, startPage + maxPages - 1);
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += '<li class="page-item ' + (i === currentPage ? 'active' : '') + '">';
                paginationHTML += '<a class="page-link" href="#" onclick="changeSearchPage(' + i + '); return false;">' + i + '</a>';
                paginationHTML += '</li>';
            }

            // Next button
            paginationHTML += '<li class="page-item ' + (currentPage === totalPages ? 'disabled' : '') + '">';
            paginationHTML += '<a class="page-link" href="#" onclick="changeSearchPage(' + (currentPage + 1) + '); return false;">Next</a>';
            paginationHTML += '</li>';

            paginationHTML += '</ul></nav>';
            paginationHTML += '<div class="text-center mt-2"><small class="text-muted">Showing ' + 
                             ((currentPage - 1) * itemsPerPage + 1) + ' to ' + 
                             Math.min(currentPage * itemsPerPage, data.length) + ' of ' + 
                             data.length + ' search results</small></div>';

            container.innerHTML = paginationHTML;
        }

        function changeSearchPage(newPage) {
            window.searchCurrentPage = newPage;
            performSearch(); // Re-run search with new page
        }

        // Enhanced toast notification function
        function showToast(message, type = 'info') {
            // Remove existing toasts
            const existingToasts = document.querySelectorAll('.custom-toast');
            existingToasts.forEach(toast => toast.remove());

            const toast = document.createElement('div');
            toast.className = 'custom-toast alert alert-' + type + ' alert-dismissible fade show';
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            `;
            
            const icon = type === 'success' ? 'check-circle' : 
                        type === 'warning' ? 'exclamation-triangle' : 
                        type === 'error' ? 'times-circle' : 'info-circle';
            
            toast.innerHTML = '<i class="fas fa-' + icon + ' me-2"></i>' + message + 
                             '<button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>';
            
            document.body.appendChild(toast);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 4000);
        }

    </script>
</body>
</html>
